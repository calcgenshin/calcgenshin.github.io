(()=>{"use strict";var t,e,s={87189:(t,e,s)=>{s.d(e,{c:()=>a});var i=s(24683),l=s(93962),r=(s(66196),s(76760)),o=s(9334);class a{constructor(t,e){this.stats=new r.j(e),this.settings=new o.q(t),this.multipliers=[],this.postEffects=[]}addStats(t){this.stats.concat(t)}addSettings(t){this.settings.concat(t)}getActivePostEffects(){return this.postEffects.filter((t=>t.isActive(this.settings)))}getActivePostEffectsTree(){let t=this.getActivePostEffects(),e=[];for(let s of t)if(s.getTree)for(let t of s.getTree(this))e.push(t);return e}applyPostEffects(t){for(let t of this.postEffectTreeByPriority()){let e=new l.x(new i.n1([]),t),s=e.compilePostTree({dontProcessStats:!0});s&&(this.stats.ensure(e.usedStats),this.stats.ensure(e.assignedStats),s(this.stats))}this.postEffects=[]}postEffectByPriority(t){t=Object.assign({},t);let e=this.getActivePostEffects(),s={};for(let i of e){let e=i.getPriority();t.maxPriority&&e>t.maxPriority||(s[e]||(s[e]=[]),s[e].push(i))}let i=[];for(let t of Object.keys(s).sort())i.push(s[t]);return i}postEffectTreeByPriority(t){let e=this.postEffectByPriority(t),s=[];for(let t of e){let e=[];for(let s of t)e=e.concat(s.getTree(this));s.push(e)}return s}getResistance(t){return this.settings.get("enemy_res_"+t)+100*this.stats.get("enemy_res_"+t)}clone(){let t=new a(this.settings,this.stats);return t.postEffects=[].concat(this.postEffects),t.multipliers=[].concat(this.multipliers),t}}},57927:(t,e,s)=>{var i=s(73935),l=s(61828),r=s(74053),o=s(93962),a=s(76760);class n{constructor(t){this.build=t.build,this.combinations=t.combinations,this.featureName=t.feature,this.settings=t.settings,this.progressCallback=t.progressCallback,this.prepare()}prepare(){this.applySets();let t=this.build.getFeatureByName(this.featureName);this.buildData=this.build.getBuildData();let e=this.buildData.getActivePostEffectsTree(),s=t.getTree(this.buildData),i=new o.x(s,e),l=i.usedStats,r=["recharge"].concat(l);this.buildData.stats.ensure(r),l.includes("crit_value")&&(this.calcCritValue=!0,l.push("crit_rate"),l.push("crit_dmg")),i.prepare(this.buildData),i.compile(),this.compiled=i,this.usefulStats=[],this.uselessStats=[],this.statRolls=function(t){let e={};for(let s of DB.Artifacts.Substats.getKeys()){let i=DB.Artifacts.Substats.get(s).rolls[4];if(e[s]="min"==t?[i[0]]:"max"==t?[i[i.length-1]]:[i[1],i[2]],(0,a.h)(s))for(let t=0;t<e[s].length;++t)e[s][t]=e[s][t]/100}return e}(this.settings.mode);for(let t of DB.Artifacts.Substats.getKeys())l.includes(t)?this.usefulStats.push(t):this.uselessStats.push(t);this.progressTotal=this.combinations.length*this.usefulStats.length,this.progressCurrent=0}setsList(){let t=Array.isArray(this.settings.sets)?[].concat(this.settings.sets):[];if(t.length<5){let e=[];for(let t of DB.Artifacts.Sets.getList())t.isBeta()||e.push(t.key);for(let s of g(e)){if(t.includes(s))continue;if(!(DB.Artifacts.Sets.get(s).maxRarity<5)&&(t.push(s),t.length>=5))break}}return g(t)}applySets(){let t=this.setsList();this.artifactSets=[].concat(t),this.build.clearArtifacts();let e=["hp","atk"];for(let s of DB.Artifacts.Slots.getKeys()){let l=new i.v(5,20,s,t.shift()||"",e.shift()||"",[]);this.build.setArtifact(l)}let s=this.build.getConditions({objects:"artifacts"}),l=r.g.allConditionsOn(s);this.settings.required_sets_settings&&(l=Object.assign(l,this.settings.required_sets_settings)),this.build.setArtifactsSettings(l)}makeTestObject(t,e){let s=new h(t,this.usefulStats,this.usefulStats,this.statRolls,this.settings);if(s.satisfyStat("recharge",this.minRecharge,e))return s}makeObject(t,e){return new h(t,this.usefulStats,this.uselessStats,this.statRolls,this.settings)}generate(){let t=[],e=this.buildData.stats.getSetFunc();this.minRecharge=this.settings.minRecharge/100;for(let s of this.combinations){let i,l=c(s),r=0;for(let t of this.usefulStats){let o=new a.j,n=this.usefulStats.length-1;e(o),l(o);let h=this.makeTestObject(s,o);if(!h){this.updateProgress();continue}let u=h.getStatRollsAllowed(t);for(let o=1;o<=u;++o){let h=new a.j;e(h),l(h);let u,f=this.makeObject(s,h);f.satisfyStat("recharge",this.minRecharge,h);for(let e=0;e<o;e++){let e=f.addRoll(t);h.add(t,e)}if(n>0)for(;;){let e,s=f.getAllowedRolls(t);if(0==s.length)break;if([e,u]=this.getBestRoll(h,s),!e)break;let i=f.addRoll(e);h.add(e,i)}else this.buildData.stats=h,u=this.compiled.execute(this.buildData)[2];u>r&&(r=u,i=f)}this.updateProgress()}i&&t.push({value:r,mainStats:s,rollsPerStat:i.getDistribution(),artifacts:i.makeArtifacts(this.setsList())})}return t.sort(((t,e)=>e.value-t.value))}getBestRoll(t,e){let s,i=0;for(let l of e){t.add(l.stat,l.value),this.calcCritValue&&t.set("crit_value",2*t.get("crit_rate")+t.get("crit_dmg")),this.buildData.stats=t;let e=this.compiled.execute(this.buildData)[2];e>i&&(i=e,s=l.stat),t.add(l.stat,-1*l.value)}return[s,i]}updateProgress(){++this.progressCurrent,this.progressCallback&&this.progressCallback({total:this.progressTotal,completed:this.progressCurrent})}}class h{constructor(t,e,s,i,l){this.mainStats={flower:"hp",plume:"atk",...t},this.usefulStats=e,this.uselessStats=s,this.rollsCnt=0,this.rolls={},this.statValues=i,this.stats=new a.j,this.settings=l}getMainStatsCnt(t){let e=0;for(let s of Object.values(this.mainStats))t==s&&++e;return e}getStatMaxAllowed(t){let e=this.settings.count,s=45,i=6*(5-this.getMainStatsCnt(t));return"crit_rate"!=t&&"crit_dmg"!=t||(s=this.settings.critRolls),Math.min(e,s,i)}getStatRollsAllowed(t){let e=0;return"crit_rate"==t||"crit_dmg"==t?(e+=this.rolls.crit_rate?this.rolls.crit_rate.length:0,e+=this.rolls.crit_dmg?this.rolls.crit_dmg.length:0):e=this.rolls[t]?this.rolls[t].length:0,this.getStatMaxAllowed(t)-e}getAllowedRolls(t){let e=[];if(this.rollsCnt>=this.settings.count)return e;let s=0;for(let t of Object.keys(this.rolls)){let e=this.rolls[t].length;for(let s of Object.values(this.mainStats))t!=s&&--e;s+=Math.max(0,e)}for(let i of DB.Artifacts.Substats.getKeys()){if(t&&t==i)continue;if(!this.usefulStats.includes(i))continue;if(s>=25&&this.rolls[i])continue;let l=this.getRollValue(i);this.getStatRollsAllowed(i)>0&&e.push({stat:i,value:l})}return e}getRollValue(t){let e=this.statValues[t].length;if(e>1){let s=(1+(this.rolls[t]?this.rolls[t].length:0))%e;return this.statValues[t][s]}return this.statValues[t][0]}satisfyStat(t,e,s){let i=s.getTotal(t);for(;i-e<-.001;){if(this.getStatRollsAllowed(t)<=0)return!1;let e=this.addRoll(t);i+=e,s.add(t,e)}return!0}addRoll(t){let e=this.getRollValue(t);return this.rolls[t]||(this.rolls[t]=[]),this.rolls[t].push(e),++this.rollsCnt,this.stats.add(t,e),e}getDistribution(){let t={};for(let[e,s]of Object.entries(this.rolls))t[e]=s.length;return t}getDistibutor(){return new u(this.mainStats,this.rolls)}makeArtifacts(t){let e=[],s=this.getDistibutor();s.process(),s.fillUselessStats(this.uselessStats,this.statValues);for(let l of Object.keys(this.mainStats)){let r=new i.v(5,20,l,t.shift(),this.mainStats[l],[]);for(let[t,e]of Object.entries(s.result[l])){let s=e.reduce(((t,e)=>t+e));(0,a.h)(t)?(s=Math.round(1e4*s)/100,s=Math.round(10*s)/10,s=parseFloat(s.toFixed(1))):s=Math.round(s),r.addStat(t,s)}e.push(r)}return e}}class u{constructor(t,e){this.mainStats=t,this.rolls={};for(let t of Object.keys(e))this.rolls[t]=[].concat(e[t]);this.prepare(),this.result={plume:{},flower:{},sands:{},goblet:{},circlet:{}},this.rollsCount={plume:0,flower:0,sands:0,goblet:0,circlet:0},this.upgradesCount={plume:0,flower:0,sands:0,goblet:0,circlet:0}}prepare(){this.possibleStatSlots={};for(let t of Object.keys(this.rolls)){this.possibleStatSlots[t]=[];for(let e of Object.keys(this.mainStats))this.mainStats[e]!=t&&this.possibleStatSlots[t].push(e)}}process(){this.lowCounters();let t={};for(let e of Object.keys(this.rolls)){let s=Object.values(this.mainStats).reduce(((t,s)=>t+(e==s?0:1)),0);t[s]||(t[s]=[]),t[s].push(e)}for(let e of Object.keys(t).sort(((t,e)=>t-e))){let s=t[e];for(;0!=s.length;)for(let t of s){let e=this.rolls[t].splice(0,1);this.putIntoLowestCount(t,e),0==this.rolls[t].length&&(delete this.rolls[t],s.splice(s.indexOf(t),1))}}this.balanceUpgrades()}balanceUpgrades(){if(Object.values(this.upgradesCount).reduce(((t,e)=>t+e),0)<=25)return;let t=1,e=0;for(;t&&!(++e>10);){t=0;t:for(let e of Object.keys(this.mainStats))if(!(this.upgradesCount[e]<=5))for(let s of Object.keys(this.result[e]))if(1!=this.result[e][s].length)for(let i of Object.keys(this.mainStats)){if(e==i)continue;if(s==this.mainStats[i])continue;if(this.result[i][s])continue;if(Object.keys(this.result[i]).length>=4)continue;let l=this.result[e][s].pop();this.result[i][s]=[l],--this.upgradesCount[e],t=1;break t}}for(e=0,t=1;t&&!(++e>10);){t=0;t:for(let e of Object.keys(this.mainStats))if(!(this.upgradesCount[e]<=5))for(let s of Object.keys(this.result[e]))if(1!=this.result[e][s].length)for(let i of Object.keys(this.mainStats)){if(e==i)continue;if(s==this.mainStats[i])continue;if(!this.result[i][s])continue;if(this.upgradesCount[i]>=5)continue;let l=this.result[e][s].pop();this.result[i][s].push(l),--this.upgradesCount[e],++this.upgradesCount[i],t=1;break t}}}fillUselessStats(t,e){for(let[s,i]of Object.entries(this.mainStats)){let l=g([].concat(t)).filter((t=>t!=i)),r=[];for(;Object.keys(this.result[s]).length<4;){let t=l.pop();if(!t)break;r.push(t),this.putIntoSlot(s,t,e[t][0])}if(0!=r.length)for(;this.upgradesCount[s]<5;)for(let t of r)if(this.putIntoSlot(s,t,e[t][0]),this.upgradesCount[s]>=5)break}}lowCounters(){for(let t of Object.keys(this.rolls))this.rolls[t].length>2||(this.putIntoLowestDifferent(t,this.rolls[t]),delete this.rolls[t])}putIntoLowestCount(t,e){let s=[];for(let[e,i]of Object.entries(this.mainStats))t!=i&&(Object.keys(this.result[e]).length>=4&&!this.result[e][t]||this.result[e][t]&&this.upgradesCount[e]>=5||s.push({slot:e,used:this.upgradesCount[e]+Object.values(this.result[e]).length-(this.result[e][t]?0:2)}));if(0==s.length)for(let[e,i]of Object.entries(this.mainStats))t!=i&&this.result[e][t]&&s.push({slot:e,used:this.upgradesCount[e]});s=s.sort(((t,e)=>t.used-e.used)),this.putIntoSlot(s[0].slot,t,e)}putIntoLowestDifferent(t,e){let s=[];for(let[e,i]of Object.entries(this.mainStats))t!=i&&(Object.keys(this.result[e])>=4&&!this.result[e][t]||s.push({slot:e,used:Object.values(this.result[e]).length}));s=s.sort(((t,e)=>t.used-e.used)),this.putIntoSlot(s[0].slot,t,e)}putIntoSlot(t,e,s){this.result[t][e]||(Object.keys(this.result[t]).length,this.result[t][e]=[]),this.result[t][e]=this.result[t][e].concat(s),this.rollsCount[t]+=s.length,this.refreshUpgrages(t)}refreshUpgrages(t){let e=0;for(let[s,i]of Object.entries(this.result[t]))e+=i.length-1;this.upgradesCount[t]=e}}function f(t){let e=t.build.clone(),s=t.build.getFeatureByName(t.feature),i=e.getBuildData(),l=s.getUsedStats(i),r={sands:[],goblet:[],circlet:[]},o={sands:"",goblet:"",circlet:""};t.settings.minRecharge>100&&l.push("recharge"),l.includes("crit_value")&&(l.push("crit_rate"),l.push("crit_dmg"));for(let t of DB.Artifacts.Mainstats.getKeys()){let e=DB.Artifacts.Mainstats.get(t);for(let s of e.slots)"flower"!=s&&"plume"!=s&&(l.includes(t)?r[s].push(t):o[s]||=t)}for(let t of Object.keys(r))0==r[t].length&&r[t].push(o[t]);let a=[];for(let t of r.sands)for(let e of r.goblet)for(let s of r.circlet)a.push({sands:t,goblet:e,circlet:s});return a}function c(t){let e=new a.j;for(let s of Object.keys(t)){let i=t[s],l=DB.Artifacts.Mainstats.get(i).values[4].getValue(20);(0,a.h)(i)&&(l/=100),e.add(i,l)}return e.getConcatFunc()}function g(t){let e,s=[].concat(t),i=s.length;for(;0!=i;)e=Math.floor(Math.random()*i),i--,[s[i],s[e]]=[s[e],s[i]];return s}class d extends n{makeTestObject(t,e){let s=new p(t,this.usefulStats,this.usefulStats,this.statRolls,this.settings);for(let t of DB.Artifacts.Substats.getKeys())for(let i=1;i<=2;++i){let i=s.addRoll(t);e.add(t,i)}if(s.satisfyStat("recharge",this.minRecharge,e))return s}makeObject(t,e){let s=new p(t,this.usefulStats,this.uselessStats,this.statRolls,this.settings);for(let t of DB.Artifacts.Substats.getKeys())for(let i=1;i<=2;++i){let i=s.addRoll(t);e.add(t,i)}return s}}class p extends h{constructor(t,e,s,i,l){(l=Object.assign({},l)).count=40,l.critRolls=40,super(t,e,s,i,l)}getStatMaxAllowed(t){let e=2+2*(5-this.getMainStatsCnt(t));return Math.min(40,e)}getStatRollsAllowed(t){let e=this.rolls[t]?this.rolls[t].length:0;return this.getStatMaxAllowed(t)-e}getDistibutor(){return new b(this.mainStats,this.rolls)}}class b extends u{fillUselessStats(){}process(){for(let t of Object.keys(this.rolls)){let e=this.rolls[t].splice(0,1);this.putIntoLowestCount(t,e),0==this.rolls[t].length&&delete this.rolls[t]}let t={};for(let e of Object.keys(this.rolls)){let s=Object.values(this.mainStats).reduce(((t,s)=>t+(e==s?0:1)),0);t[s]||(t[s]=[]),t[s].push(e)}let e={};for(let t of Object.keys(this.rolls))e[t]=this.rolls[t].length;for(let t of Object.keys(e).sort(((t,s)=>e[s]-e[t])))for(;this.rolls[t]&&this.rolls[t].length>0;){let e=this.rolls[t].splice(0,1);this.putIntoLowestCount(t,e),0==this.rolls[t].length&&delete this.rolls[t]}}}importScripts("db.js?3.1.3b"),self.onmessage=function(t){let e=l.G.deserialize(t.data.build),s=t.data.feature,o=t.data.items,a=[],h=t.data.generatorSettings;var u;u=o.length,"undefined"!=typeof self&&self.postMessage({progress:{total:u}});let c=[];if(t.data.storage)for(let e of t.data.storage.artifacts)c.push(i.v.deserialize(e));for(let i of o){let l=DB.Weapons.getById(i.weaponId),o=e.clone(),u=[];if(o.setWeapon(l),o.setWeaponLevels({level:90,ascension:6,refine:i.refine}),o.setWeaponSettings(i.settings),"generate"==t.data.artifactMode){let t,e={build:o.clone(),feature:s,settings:{sets:h.sets,count:h.count,critRolls:h.critRolls,mode:h.mode,minRecharge:h.minRecharge,kqms:h.kqms,required_sets_settings:h.required_sets_settings}};e.combinations=f(e),t=e.settings.kqms?new d(e):new n(e);let i=t.generate();for(let t of i[0].artifacts)u.push(t.serialize());o.replaceArtifacts(i[0].artifacts);let l=o.getConditions({objects:"artifacts"}),a=r.g.allConditionsOn(l);h.required_sets_settings&&(a=Object.assign(a,h.required_sets_settings)),o.setArtifactsSettings(a)}let c=o.getFeatureByName(s),p=o.getBuildData(),b=c.getResult(p)[s];if(b){let t={weaponId:i.weaponId,suggestName:i.suggestName,level:i.level,ascension:i.ascension,refine:i.refine,result:b,artifacts:u};self.postMessage({partial:t}),a.push(t)}g=void 0,"undefined"!=typeof self&&self.postMessage({progress:{inc:g||1}})}var g;self.postMessage({result:a})}}},i={};function l(t){var e=i[t];if(void 0!==e)return e.exports;var r=i[t]={exports:{}};return s[t](r,r.exports,l),r.exports}l.m=s,l.x=()=>{var t=l.O(void 0,[651],(()=>l(57927)));return t=l.O(t)},t=[],l.O=(e,s,i,r)=>{if(!s){var o=1/0;for(h=0;h<t.length;h++){for(var[s,i,r]=t[h],a=!0,n=0;n<s.length;n++)(!1&r||o>=r)&&Object.keys(l.O).every((t=>l.O[t](s[n])))?s.splice(n--,1):(a=!1,r<o&&(o=r));a&&(t.splice(h--,1),e=i())}return e}r=r||0;for(var h=t.length;h>0&&t[h-1][2]>r;h--)t[h]=t[h-1];t[h]=[s,i,r]},l.d=(t,e)=>{for(var s in e)l.o(e,s)&&!l.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},l.f={},l.e=t=>Promise.all(Object.keys(l.f).reduce(((e,s)=>(l.f[s](t,e),e)),[])),l.u=t=>"js/"+t+"_edc88974b4af9385efeb.js",l.miniCssF=t=>{},l.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),l.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t;l.g.importScripts&&(t=l.g.location+"");var e=l.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var s=e.getElementsByTagName("script");s.length&&(t=s[s.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),l.p=t+"../"})(),(()=>{var t={327:1};l.f.i=(e,s)=>{t[e]||importScripts(l.p+l.u(e))};var e=self.webpackChunkgenshin_impact_calculator=self.webpackChunkgenshin_impact_calculator||[],s=e.push.bind(e);e.push=e=>{var[i,r,o]=e;for(var a in r)l.o(r,a)&&(l.m[a]=r[a]);for(o&&o(l);i.length;)t[i.pop()]=1;s(e)}})(),e=l.x,l.x=()=>l.e(651).then(e);l.x()})();