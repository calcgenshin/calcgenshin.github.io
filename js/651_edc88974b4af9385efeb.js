(self.webpackChunkgenshin_impact_calculator=self.webpackChunkgenshin_impact_calculator||[]).push([[651],{73935:(t,e,s)=>{"use strict";s.d(e,{v:()=>a});var i=s(58121),r=s(76760),n=s(19478);class a{constructor(t,e,s,i,r,n){this.rarity=t,this.level=e,this.slot=s,this.set=i,this.mainStat=r,this.subStats=n||[],this.locked=!1,this.groups=[],this.calculated=null}addStat(t,e){this.subStats.push({stat:t,value:e}),this.calculated=null}calcStats(){const t=new r.j;let e=DB.Artifacts.Mainstats.get(this.mainStat);if(e){let s=e.values[this.rarity-1];t.add(this.mainStat,s.getValue(this.level))}for(let e=0;e<this.subStats.length;++e){let s=this.subStats[e],i=DB.Artifacts.Substats.get(s.stat);t.add(s.stat,i.getPreciseValue(s.value,this.rarity))}return t.add("crit_value",2*t.get("crit_rate")+t.get("crit_dmg")),t}calcCache(t){this.calculated=this.calcStats(),this.calculated.truncate(t),this.calculated.processPercent()}replace(t){this.rarity=t.rarity,this.level=t.level,this.slot=t.slot,this.set=t.set,this.mainStat=t.mainStat,this.subStats=t.subStats,this.groups=t.getGroups(),this.calculated=null}getLevel(){return this.level}getSet(){return this.set}getRarity(){return this.rarity}getMainStat(){return""+this.mainStat}getSetName(){return""+this.set}getSlot(){return""+this.slot}getMainStatValue(){let t=this.getMainStat();return t?DB.Artifacts.Mainstats.get(t).values[this.rarity-1].getValue(this.level):0}getSubStats(){return this.subStats}setGroups(t){let e=t;Array.isArray(t)||(e=[t]);let s=[];for(let t of e){let e=a.trimGroupName(t);a.inGroups(s,e)||s.push(e)}this.groups=s}getGroups(){return this.groups&&0!=this.groups.length?this.groups:[""]}hasGroup(t){let e=t.toUpperCase();for(let t of this.groups)if(e==t.toUpperCase())return!0;return!1}inGroups(t){for(let e of t)if(this.hasGroup(e))return!0;return!1}isValid(){return 0==this.getErrors().length}setLocked(t){this.locked=!!t}isLocked(){return this.locked}getHash(){return i.e.pack(this)}getErrors(){let t=[];DB.Artifacts.Sets.get(this.set)||t.push("no_set"),DB.Artifacts.Mainstats.get(this.mainStat)||t.push("no_main_stat");let e=DB.Artifacts.Rarity[this.rarity-1],s=this.subStats.length;(s<e.minSubstats||s>e.maxSubstats)&&t.push("substat_count_mismatch");let i=!1,r=!1,a=!1,l=!1,o=[],c=0;for(const t of this.subStats){t.stat==this.mainStat&&(i=!0),o.includes(t.stat)&&(l=!0),o.push(t.stat);let e=(0,n.O)(t.stat,this.rarity,t.value);e.last>0&&(e.steps.length<e.maxUpgrades?a=!0:r=!0),e.steps.length>1&&(c+=e.steps.length-1)}let u=e.maxSubstats-4+Math.floor(this.level/4),h=Math.max(0,e.minSubstats-4+Math.floor(this.level/4));return c>0&&this.subStats.length<4&&t.push("not_full_substats"),(c>u||c>=e.maxUpgrades)&&t.push("too_much_upgrades"),c<h-1&&t.push("too_low_upgrades"),i&&t.push("substat_equal_main"),a&&t.push("substat_value_rolls"),r&&t.push("substat_value_range"),l&&t.push("substat_duplicate"),t}getErrorsFormatted(){let t=this.getErrors();if(0==t.length)return"";let e="";for(const s of t)e+="<p>"+UI.Lang.get("artifact_error."+s)+"</p>";return e}toGood(){let t=DB.Artifacts.Sets.get(this.set),e=DB.Artifacts.Mainstats.get(this.mainStat),s={setKey:t.getGoodId(),slotKey:this.slot,level:this.level,rarity:this.rarity,mainStatKey:e.goodId,location:"",lock:!1,substats:[]};for(const t of this.subStats){let e=DB.Artifacts.Substats.get(t.stat);if(!e)return null;s.substats.push({key:e.goodId,value:t.value})}return s}serialize(){let t=[1];t.push(DB.Artifacts.Sets.getId(this.set)),t.push(this.rarity),t.push(this.level),t.push(DB.Artifacts.Slots.getId(this.slot)),t.push(DB.Artifacts.Mainstats.getId(this.mainStat)||0),t.push(this.subStats.length);for(const e of this.subStats){t.push(DB.Artifacts.Substats.getId(e.stat));let s=DB.Artifacts.Substats.get(e.stat),i=e.value;"percent"==s.type&&(i=Math.floor(10*i)),t.push(i)}return t}clone(){return a.deserialize(this.serialize())}static deserialize(t){let e=null;if(1==t.shift()){let s=DB.Artifacts.Sets.getKeyId(t.shift());if(!s)return null;let i=t.shift();if(i<1||i>5)return null;let r=t.shift();if(r<0||r>20)return null;let n=DB.Artifacts.Slots.getKeyId(t.shift());if(!n)return null;let l=DB.Artifacts.Mainstats.getKeyId(t.shift())||"",o=t.shift();if(o<0||o>4)return null;e=new a(i,r,n,s,l);for(let s=1;s<=o;++s){let s=DB.Artifacts.Substats.getKeyId(t.shift());if(!s)return null;let i=t.shift();if(i<1)return null;let r=DB.Artifacts.Substats.get(s);if(!r)return null;i="percent"==r.type?parseFloat(i)/10:parseInt(i),e.addStat(s,i)}}return e}static fromGood(t){let e=DB.Artifacts.Sets.getKeyIdGood(t.setKey),s=DB.Artifacts.Sets.get(e);if(!s)return null;if(!DB.Artifacts.Slots.get(t.slotKey))return null;let i=DB.Artifacts.Mainstats.getKeyIdGood(t.mainStatKey),r=DB.Artifacts.Mainstats.get(i);if(!r)return null;if(!r.slots.includes(t.slotKey))return null;if(t.rarity<s.minRarity&&t.rarity>s.maxRarity)return null;let n=DB.Artifacts.Rarity[t.rarity-1];if(t.level<0&&t.level>n.maxLevel)return null;let l=new a(t.rarity,t.level,t.slotKey,e,i);if(Array.isArray(t.substats)){if(t.substats.length>4)return null;for(const e of t.substats){if(!e.key)continue;let t=DB.Artifacts.Substats.getKeyIdGood(e.key);if(!t)return null;let s=e.value;l.addStat(t,s)}}return l}static subStatsIsSimilar(t,e){if(t.subStats.length<e.subStats.length)return!1;for(let s=0;s<e.subStats.length;++s)if(t.subStats[s].stat!=e.subStats[s].stat||t.subStats[s].value<e.subStats[s].value)return!1;return!0}static inGroups(t,e){for(let s of t)if(a.groupsAreEqual(s,e))return!0;return!1}static groupsAreEqual(t,e){return t.toUpperCase()==e.toUpperCase()}static trimGroupNames(t){Array.isArray(t)||(t=[t]);let e=[];for(let s of t)e.push(a.trimGroupName(s));return e}static trimGroupName(t){let e=t||"";return e=e.replace(/[^\w\u0400-\u04ff\d_\-\s]/g,""),e=e.replace(/\s+/g," "),e.trim()}static settingName(t){return"set_pieces."+t.toLowerCase()}static settingNameShort(t){return t.toLowerCase()}}},9334:(t,e,s)=>{"use strict";s.d(e,{q:()=>i,$:()=>r});class i{constructor(t){Object.assign(this,t)}set(t,e){this[t]=e}get(t){return this[t]}getNumber(t){return this[t]||0}concat(){for(let t of arguments)Object.assign(this,t)}getLevel(t){return r(t,this)}}function r(t,e){let s=e[t]||1;s+=e[t+"_bonus"]||0,s+=e[t+"_bonus_2"]||0;let i=/\w+_(char_skill_\w+)/.exec(t);return i&&(s+=e[i[1]+"_bonus_party"]||0),s}},81748:(t,e,s)=>{"use strict";s.d(e,{r:()=>n});var i=s(76760),r=s(74053);class n{constructor(){this.object=null,this.settings={}}getName(){return this.object&&this.object.getName()||""}getIcon(){return this.object&&this.object.getIcon()||""}getRarity(){return this.object&&this.object.getRarity()||1}set(t){this.object=t,this.removeInvalidSettings()}get(){return this.object}getConditions(){return this.object&&this.object.getConditions()||[]}getFeatures(){return this.object&&this.object.getFeatures()||[]}getPostEffects(){return this.object&&this.object.getPostEffects()||[]}getMultipliers(){return this.object&&this.object.getMultipliers()||[]}getSettings(){return Object.assign({},this.settings)}getLevels(){return this.levels}getStats(){const t=new i.j;if(this.object&&this.object.statTable)for(let e=0;e<this.object.statTable.length;++e){let s=this.object.statTable[e],i=s.getValue(this.levels.level,this.levels.ascension);t.add(s.getName(),i)}return{stats:t,settings:{}}}setSettings(t){this.settings=t}modifySettings(t){return Object.assign(this.settings,t),this.getSettings()}addSettings(t){this.settings=Object.assign(this.settings,t)}isBeta(){return this.object&&this.object.isBeta()}serialize(){return[]}removeInvalidSettings(){let t=this.getConditions(),e=r.g.allConditionsOn(t);for(const t of Object.keys(this.settings))void 0===e[t]&&delete this.settings[t]}serializeConditions(t,e){let s=0,i=[],n=[];if(e)for(const s of r.g.unwrap(e,t))s.isActive(t)&&n.push(s);else for(const e of r.g.unwrap(this.getConditions({serialize:!0}),t))e.isActive(t)&&n.push(e);for(const e of n){if(!e.params.serializeId)continue;let r=e.getType();if("checkbox"==r)++s,i.push(e.params.serializeId);else if("stacks"==r)++s,i.push(e.params.serializeId),i.push(t[e.getName()]);else if("number"==r){++s,i.push(e.params.serializeId);let r=t[e.getName()]||0;r="decimal"==e.params.format?Math.floor(10*parseFloat(r)):parseInt(r),i.push(Math.max(0,r))}else if("dropdown"==r||"dropdown_multiple"==r){let r=e.getSelectedId(t);r&&(++s,i.push(e.params.serializeId),i.push(r))}else if("char"==r){let r=this.serializeChars(t);r.length&&(++s,i.push(e.params.serializeId),i=i.concat(r))}else if("custom_buffs"==r){let r=this.serializeCustomBuffs(t);r.length&&(++s,i.push(e.params.serializeId),i=i.concat(r))}}return i.unshift(s),i}serializeChars(t){return[]}serializeCustomBuffs(t){return[]}deserializeChars(t){return{}}deserializeCustomBuffs(t){return{}}deserializeConditions(t,e){let s={},i=t.shift(),n={};if(e)for(const t of r.g.unwrap(e))t.params.serializeId&&(n[t.params.serializeId]=t);else for(const t of r.g.unwrap(this.getConditions({serialize:!0})))t.params.serializeId&&(n[t.params.serializeId]=t);for(let e=1;e<=i;++e){let i=t.shift();if(e<1)return;let r=n[i];if(!r)return;let a=r.getType();if("checkbox"==a)s[r.getName()]=!0;else if("stacks"==a){let e=t.shift();e>r.params.maxStack&&(e=r.params.maxStack),s[r.getName()]=e}else if("number"==a){let e=t.shift();"decimal"==r.params.format&&(e=(e/10).toFixed(1)),s[r.getName()]=e}else if("dropdown"==a||"dropdown_multiple"==a){let e=r.getValueById(t.shift());s[r.getName()]=e||""}else"char"==a?s=Object.assign(s,this.deserializeChars(t)):"custom_buffs"==a&&(s=Object.assign(s,this.deserializeCustomBuffs(t)))}return s}}},59198:(t,e,s)=>{"use strict";s.d(e,{V:()=>l});var i=s(73935),r=s(81748),n=s(76760);const a=["flower","plume","sands","goblet","circlet"];class l extends r.r{constructor(){super(),this.artifacts={flower:null,plume:null,sands:null,goblet:null,circlet:null}}get(){return this.artifacts}hasEquipped(){for(let t of a)if(this.artifacts[t])return!0;return!1}getSettings(){let t=Object.assign({},this.settings),e={};for(let t of a){let s=this.artifacts[t];s&&(e[s.set]=1+(e[s.set]||0))}for(let s of Object.keys(e))t[i.v.settingName(s)]=e[s];return t}getFeatures(){let t=[],e=this.activeSets(),s=Object.keys(e);for(let i=0;i<s.length;++i){let r=s[i],n=DB.Artifacts.Sets.get(r);if(n){let s=n.getFeatures(e[r]);t=t.concat(s)}}return t}isBeta(){let t=this.activeSets(),e=Object.keys(t);for(let t of e){let e=DB.Artifacts.Sets.get(t);if(e&&e.isBeta())return!0}return!1}getStats(t){let e={stats:new n.j,settings:{}};for(let s=0;s<a.length;++s){const i=a[s];let r=this.artifacts[i];r&&e.stats.concat(r.calcStats(t))}return e}getConditions(){let t=[],e=this.activeSets(),s=Object.keys(e);for(let i=0;i<s.length;++i){let r=s[i],n=DB.Artifacts.Sets.get(r);if(n){let s=n.getConditions(e[r]);t=t.concat(s)}}return t}getPostEffects(){let t=[];for(let e of DB.Artifacts.Sets.getList()){let s=e.getPostEffects();t=t.concat(s)}return t}getMultipliers(){let t=[],e=this.activeSets();for(const[s,i]of Object.entries(e)){let e=DB.Artifacts.Sets.get(s);if(e){let s=e.getMultipliers(i);t=t.concat(s)}}return t}modifySets(t){let e=[].concat(t),s={},i=DB.Artifacts.Sets.getKeys();for(let t=0;t<a.length;++t){const r=a[t];let n=this.artifacts[r];if(n){let t=e.shift();if(!t)for(const e of i){if(s[e])continue;let i=DB.Artifacts.Sets.get(e);i.getConditions(1).length||i.minRarity<=n.rarity&&i.maxRarity>=n.rarity&&(t=e)}s[t]=1,n.set=t}}}set(t){let e=t.slot;this.artifacts[e]=t,this.removeInvalidSettings()}replace(t){for(let e of t){let t=e.slot;this.artifacts[t]=e}this.removeInvalidSettings()}remove(t){let e=t.getHash();for(let t=0;t<a.length;++t){const s=a[t];let i=this.artifacts[s];i&&i.getHash()==e&&(this.artifacts[s]=null,this.removeInvalidSettings())}}clearArtifacts(){for(let t=0;t<a.length;++t){const e=a[t];this.artifacts[e]=null}}isEquipped(t){let e=t.slot;return!(!this.artifacts[e]||this.artifacts[e]!=t)}activeSets(){let t={};for(let e=0;e<a.length;++e){const s=a[e];let i=this.artifacts[s];i&&(i.set&&(t[i.set]||(t[i.set]=0),++t[i.set]))}return t}serialize(t){let e=[],s=0;for(let t=0;t<a.length;++t){const i=a[t];let r=this.artifacts[i];r&&(++s,e=e.concat(r.serialize()))}e.unshift(s);let i=this.serializeConditions(t);return e.concat(i)}static deserialize(t){let e=t.shift();if(e<0||e>5)return null;let s=new l;for(let r=1;r<=e;++r){let e=i.v.deserialize(t);if(!e)return null;s.set(e)}let r=s.deserializeConditions(t);return r?(s.setSettings(r),s):null}}},58512:(t,e,s)=>{"use strict";s.d(e,{T:()=>l});var i=s(81748),r=s(76760);const n={atk:{serializeId:1,flat:!0},atk_percent:{serializeId:2},def:{serializeId:3,flat:!0},def_percent:{serializeId:4},hp:{serializeId:5,flat:!0},hp_percent:{serializeId:6},mastery:{serializeId:7,flat:!0},recharge:{serializeId:8},crit_rate:{serializeId:9},crit_dmg:{serializeId:10},healing:{serializeId:11},healing_recv:{serializeId:12},shield:{serializeId:13},recharge:{serializeId:14},crit_rate:{serializeId:15},crit_dmg:{serializeId:16},healing:{serializeId:17},healing_recv:{serializeId:18},shield:{serializeId:19},dmg_all:{serializeId:20},dmg_anemo:{serializeId:21},dmg_cryo:{serializeId:22},dmg_dendro:{serializeId:23},dmg_electro:{serializeId:24},dmg_geo:{serializeId:25},dmg_hydro:{serializeId:26},dmg_pyro:{serializeId:27},dmg_phys:{serializeId:28},dmg_normal:{serializeId:29},dmg_charged:{serializeId:30},dmg_plunge:{serializeId:31},dmg_skill:{serializeId:32},dmg_burst:{serializeId:33},enemy_def_reduce:{serializeId:34},enemy_def_ignore:{serializeId:35}};let a={};for(let t of Object.keys(n))a[n[t].serializeId]=t;class l extends i.r{constructor(){super(),this.buffs=DB.Buffs,this.partyCharIds=[]}get(){return this.buffs}getFeatures(){return[]}isBeta(){return!1}getStats(t){return{stats:new r.j,settings:{}}}getConditions(t){let e=[];t||={};for(const t of this.buffs.getList())e=e.concat(t.getConditions());let s=this.getPartyChars();if(!t.serialize)for(let t=0;t<s.length;++t){let i=s[t];const r=DB.Chars.getById(i);r&&(e=e.concat(r.getPartyConditions()))}return e}getMultipliers(){let t=[];for(const e of this.buffs.getList())t=t.concat(e.getMultipliers());let e=this.getPartyChars();for(let s of e){const e=DB.Chars.getById(s);e&&(t=t.concat(e.getPartyMultipliers()))}return t}getPostEffects(){let t=[],e=this.getPartyChars();for(const e of this.buffs.getList())t=t.concat(e.getPostEffects());for(let s=0;s<e.length;++s){let i=e[s];const r=DB.Chars.getById(i);r&&(t=t.concat(r.getPartyPostEffects()))}return t}setPartyChars(t){this.partyCharIds=[];for(const e of t)e&&DB.Chars.getById(e)&&this.partyCharIds.push(e)}getPartyChars(){return[].concat(this.partyCharIds)}getSettings(){let t=super.getSettings(),e=1;for(let s=1;s<=3;++s){let i=this.partyCharIds[s-1];const r=DB.Chars.getById(i);r?(++e,t["party_char_"+s]=i,t["resonance_element_"+s]=r.getElement()):(t["party_char_"+s]=0,t["resonance_element_"+s]="")}return t.party_size=e,t}serialize(t){let e=this.serializeConditions(t);return[].concat(e)}serializeChars(t){let e=this.getPartyChars(),s=[],i=0;for(let r=0;r<e.length;++r){let n=e[r],a=DB.Chars.getById(n);if(a){++i;let e=a.getPartyConditions(),r=this.serializeConditions(t,e);s.push(n),s=s.concat(r)}}return s.unshift(i),s}serializeCustomBuffs(t){let e=0,s=[];for(let i of Object.keys(n)){let r=t["custom_buffs."+i];if(!r)continue;++e;let a=n[i];s.push(a.serializeId),a.flat?s.push(Math.floor(r)):s.push(Math.floor(10*r))}return e&&s.unshift(e),s}deserializeChars(t){let e=t.shift(),s={};for(let i=0;i<e;++i){let e=t.shift(),r=DB.Chars.getById(e);if(!r)return null;let n=r.getPartyConditions();s["party_char_"+(i+1)]=e;let a=this.deserializeConditions(t,n);s=Object.assign(s,a)}return s}deserializeCustomBuffs(t){let e=t.shift(),s={};for(let i=0;i<e;++i){let e=t.shift(),i=a[e];if(!i)return null;let r=n[i],l=t.shift();r.flat||(l/=10),s["custom_buffs."+i]=l}return s}static deserialize(t){let e=new l,s=e.deserializeConditions(t);if(!s)return null;let i={};e.partyCharIds=[];for(let t=1;t<=3;++t)s["party_char_"+t]&&e.partyCharIds.push(s["party_char_"+t]);if(0==e.partyCharIds.length)for(let t=1;t<=3;++t){let r=s["old_resonance_element_"+t];if(r){delete s["old_resonance_element_"+t];for(const t of DB.Chars.getList()){let s=t.getId();if(!i[s]&&r==t.getElement()){e.partyCharIds.push(s),i[s]=1;break}}}}return e.setSettings(s),e}}},50170:(t,e,s)=>{"use strict";s.d(e,{D:()=>n});var i=s(81748);const r=new(s(25627).I)("",[1,2,4,6,8,10]);class n extends i.r{constructor(){super(),this.levels={level:1,ascension:0,constellation:0},this.skills={attack:1,elemental:1,burst:1}}setLevels(t){this.levels.level=t.level,this.levels.ascension=t.ascension,this.levels.constellation=t.constellation}getLevels(){return{level:this.levels.level,ascension:this.levels.ascension,constellation:this.levels.constellation}}setSkills(t){this.skills.attack=t.attack,this.skills.elemental=t.elemental,this.skills.burst=t.burst}getId(){return this.object?this.object.getId():0}getName(){return this.object?this.object.getName():""}getSkills(){return{attack:this.skills.attack,elemental:this.skills.elemental,burst:this.skills.burst}}getConditions(){let t=super.getConditions();if(!this.object)return t;let e=this.object.constellation;return e&&(t=t.concat(e.getConditions(this.levels.constellation))),t=t.concat(DB.Conditions.Character),t}getFeatures(){let t=super.getFeatures();if(!this.object)return t;let e=this.getConstellation();return e&&(t=t.concat(e.getFeatures(this.levels.constellation))),t}getSettings(){let t=super.getSettings(),e=r.getValue(this.levels.ascension||1),s={char_skill_attack:Math.min(e,this.skills.attack),char_skill_elemental:Math.min(e,this.skills.elemental),char_skill_burst:Math.min(e,this.skills.burst),char_level:this.levels.level,char_ascension:this.levels.ascension,char_constellation:this.levels.constellation};return this.object&&(s.char_id=this.object.getId(),s.char_name=this.object.name,s.char_element=this.object.element,s.char_origin=this.object.origin),t=Object.assign(t,s),t}getConstellation(){return this.object.constellation}getElement(){return this.object&&this.object.getElement()||""}getWeaponType(){return this.object&&this.object.getWeapon()||""}serialize(t){let e=[];if(!this.object)return null;e.push(this.object.getId()),e.push(this.levels.level,this.levels.ascension,this.levels.constellation),e.push(this.skills.attack,this.skills.elemental,this.skills.burst);let s=this.serializeConditions(t);return e.concat(s)}static deserialize(t){let e=DB.Chars.getById(t.shift());if(!e)return null;let s=t.shift();if(s<1||s>100)return null;let i=t.shift();if(i<0||i>6)return null;let r=t.shift();if(r<0||r>6)return null;let a=t.shift();if(a<1||a>10)return null;let l=t.shift();if(l<1||l>10)return null;let o=t.shift();if(o<1||o>10)return null;let c=new n;c.set(e),c.setLevels({level:s,ascension:i,constellation:r}),c.setSkills({attack:a,elemental:l,burst:o});let u=c.deserializeConditions(t);return u?(c.setSettings(u),c):null}}},48771:(t,e,s)=>{"use strict";s.d(e,{n:()=>n});var i=s(81748),r=s(76760);class n extends i.r{constructor(){super(),this.levels={level:1},this.resistances={phys:0,anemo:0,cryo:0,geo:0,hydro:0,pyro:0,electro:0,dendro:0}}setLevels(t){this.levels.level=t.level}setResistances(t){for(const e of["anemo","cryo","dendro","electro","geo","hydro","phys","pyro"])this.resistances[e]=parseInt(t[e])||0}getResistances(){return this.object?this.object.getResistances():this.resistances}getStats(){return{stats:new r.j,settings:{}}}getSettings(){let t=super.getSettings(),e=this.getResistances();return t=Object.assign(t,{enemy_level:this.levels.level,enemy_res_phys:e.phys||0,enemy_res_anemo:e.anemo||0,enemy_res_cryo:e.cryo||0,enemy_res_geo:e.geo||0,enemy_res_hydro:e.hydro||0,enemy_res_pyro:e.pyro||0,enemy_res_electro:e.electro||0,enemy_res_dendro:e.dendro||0}),this.object&&(t.enemy_type=this.object.type,t=Object.assign(t,this.object.getSettings())),t}getConditions(){let t=super.getConditions();return t=t.concat(DB.Conditions.Enemy),t}serialize(t){let e=[];e.push(this.levels.level),this.object?(e.push(2),e.push(this.object.getId())):(e.push(1),e.push(this.resistances.anemo+100),e.push(this.resistances.cryo+100),e.push(this.resistances.dendro+100),e.push(this.resistances.electro+100),e.push(this.resistances.geo+100),e.push(this.resistances.hydro+100),e.push(this.resistances.phys+100),e.push(this.resistances.pyro+100));let s=this.serializeConditions(t);return e.concat(s)}static deserialize(t){let e=t.shift();if(e<1||e>110)return null;let s=t.shift(),i=new n;if(i.setLevels({level:e}),1==s){let e={};for(const s of["anemo","cryo","dendro","electro","geo","hydro","phys","pyro"]){let i=t.shift()-100;if(i<-100||i>1e3)return null;e[s]=i}i.setResistances(e)}else{if(2!=s)return null;{let e=DB.Enemies.getById(t.shift());if(!e)return null;i.set(e)}}let r=i.deserializeConditions(t);return r?(i.setSettings(r),i):null}}},25960:(t,e,s)=>{"use strict";s.d(e,{a:()=>a});var i=s(81748),r=s(76760);const n=["Attack","Defence","Potion"];class a extends i.r{constructor(){super(),this.food={Attack:{item:null,level:0},Defence:{item:null,level:0},Potion:{item:null,level:0}}}get(t){let e=this.food[t];if(e.item)return e.item}getLevel(t){let e=this.food[t];return e.item?e.level:0}set(t,e,s){this.food[t]={item:e,level:s}}isBeta(){return!1}getSettings(){return{}}getStats(t){let e={stats:new r.j,settings:{}};for(let t=0;t<n.length;++t){const s=n[t];let i=this.food[s];i.item&&e.stats.concat(i.item.getStats(i.level))}return e}getConditions(){return[]}getPostEffects(){return[]}serialize(){let t=[],e=0;for(let s=0;s<n.length;++s){const i=n[s];++e;let r=this.food[i];r.item?(t.push(r.item.getId()),t.push(r.level)):t.push(0)}return t.unshift(e),t}static deserialize(t){let e=new a,s=t.shift();for(let i=0;i<s;++i){let s=n[i];if(!s)return null;let r=t.shift(),a=0,l=DB.Food.get(s).getById(r);r>0&&(a=t.shift()),l&&(e.food[s]={item:l,level:a})}return e}}},4312:(t,e,s)=>{"use strict";s.d(e,{X:()=>a});var i=s(9334),r=s(81748),n=s(76760);class a extends r.r{isBeta(){return!1}getSettings(){return{}}getStats(t){return{stats:new n.j,settings:new i.q({})}}getConditions(){return[]}getFeatures(){return DB.Features.Reactions}getPostEffects(){return[]}}},39673:(t,e,s)=>{"use strict";s.d(e,{V:()=>n});var i=s(81748),r=s(43164);s(42651);class n extends i.r{constructor(){super(),this.object=new r.mi}set(t){this.object=t?t.clone():new r.mi}isBeta(){return!1}getConditions(){return[]}getFeatures(){return[]}getPostEffects(){return[]}getSettings(){return[]}getMultipliers(){return[]}serialize(){return this.object.serialize()}static deserialize(t){if(0==t.length)return new n;let e=r.mi.deserialize(t),s=new n;return s.set(e),s}}},92913:(t,e,s)=>{"use strict";s.d(e,{q:()=>a});var i=s(9334),r=s(81748),n=s(76760);class a extends r.r{isBeta(){return!1}getSettings(){return{}}getStats(t){return{stats:new n.j,settings:new i.q({})}}getConditions(){return[]}getFeatures(){return DB.Features.Stats}getPostEffects(){return[]}}},49636:(t,e,s)=>{"use strict";s.d(e,{o:()=>r});var i=s(81748);class r extends i.r{constructor(){super(),this.levels={level:1,ascension:0,refine:1}}setLevels(t){this.levels.level=t.level,this.levels.ascension=t.ascension,this.levels.refine=Math.min(5,Math.max(1,t.refine))}getStats(){const t=super.getStats();if(this.object&&this.object.refineTable)for(let e of this.object.refineTable)t.stats.add(e.getName(),e.getValue(this.levels.refine));return t}getSettings(){let t=super.getSettings(),e={weapon_level:this.levels.level,weapon_ascension:this.levels.ascension,weapon_refine:this.levels.refine};return this.object&&(e.weapon_id=this.object.getId(),e.weapon_type=this.object.weapon),t=Object.assign(t,e),t}getId(){return this.object?this.object.getId():0}getName(){return this.object?this.object.getName():""}getConditions(){let t=super.getConditions();return t=t.concat(DB.Conditions.Weapon),t}serialize(t){let e=[];if(!this.object)return null;e.push(this.object.getId()),e.push(this.levels.level,this.levels.ascension,this.levels.refine);let s=this.serializeConditions(t);return e.concat(s)}static deserialize(t){let e=DB.Weapons.getById(t.shift());if(!e)return null;let s=t.shift();if(s<1||s>90)return null;let i=t.shift();if(i<0||i>6)return null;let n=t.shift();if(n<0||n>5)return null;let a=new r;a.set(e),a.setLevels({level:s,ascension:i,refine:n||1});let l=a.deserializeConditions(t);return l?(a.setSettings(l),a):null}}},61828:(t,e,s)=>{"use strict";s.d(e,{s:()=>y,G:()=>w});var i=s(87189),r=s(59198),n=s(58512),a=s(50170),l=s(48771),o=s(25960),c=s(4312),u=s(39673),h=s(92913),f=s(49636),g=s(74053),p=s(66196),d=s(42651),m=s(58121);const y=["char","weapon","artifacts","enemy","buffs","rotation","food","reaction","static"],b=["char","weapon","artifacts","enemy","buffs","rotation","food"];class w{constructor(){this.char=new a.D,this.weapon=new f.o,this.artifacts=new r.V,this.enemy=new l.n,this.buffs=new n.T,this.rotation=new u.V,this.food=new o.a,this.reaction=new c.X,this.static=new h.q}getChar(){return this.char}setChar(t){let e=this.getCommonSettings("char");this.char.set(t);let s="";this.weapon.object&&(s=this.weapon.object.weapon),s!=t.weapon&&this.setWeapon(DB.Weapons.get(t.weapon).getFirst());let i=this.buffs.getPartyChars();this.buffs.setPartyChars(i.filter((e=>e!=t.getId()))),this.setCharSettings(e)}setCharLevels(t){this.char.setLevels(t)}setCharSkills(t){this.char.setSkills(t)}setCharSettings(t){this.char.setSettings(t),this.setCommonSettings(t)}getWeapon(){return this.weapon}setWeapon(t){let e=this.getCommonSettings("weapon");this.weapon.set(t),this.setWeaponSettings(e)}setWeaponLevels(t){this.weapon.setLevels(t)}setWeaponSettings(t){this.weapon.setSettings(t),this.setCommonSettings(t)}setEnemy(t){this.enemy.set(t)}setEnemyLevels(t){this.enemy.setLevels(t)}setEnemyResistances(t){this.enemy.setResistances(t)}setEnemySettings(t){this.enemy.setSettings(t),this.setCommonSettings(t)}getEnemy(){return this.enemy}setArtifact(t){this.artifacts.set(t)}replaceArtifacts(t){this.artifacts.replace(t)}getArtifacts(){return this.artifacts.get()}getArtifactsHashList(){let t=[],e=this.getArtifacts();return Object.keys(e).forEach((function(s){let i=e[s];i&&t.push(i.getHash())})),t}removeArtifact(t){this.artifacts.remove(t)}clearArtifacts(){this.artifacts.clearArtifacts()}setArtifactsSettings(t){this.artifacts.setSettings(t),this.setCommonSettings(t)}isEquipped(t){return this.artifacts.isEquipped(t)}getBuffs(){return this.buffs.get()}setBuffsSettings(t){this.buffs.setSettings(t),this.setCommonSettings(t)}modifyBuffsSettings(t){let e=this.buffs.modifySettings(t);this.setCommonSettings(e)}setPartyChars(t){this.buffs.setPartyChars(t)}getPartyChars(){return this.buffs.getPartyChars()}setRotation(t){this.rotation.set(t)}getRotation(){return this.rotation.get()}setFood(t,e,s){return this.food.set(t,e,s)}getFood(t){return this.food.get(t)}getFoodLevel(t){return this.food.getLevel(t)}hasBetaContent(){for(let t of y)if(this[t]&&this[t].isBeta())return!0;return!1}refreshCommonSettings(){let t=this.getSettings();for(let e of y){if(!this[e])continue;let s=this[e].getSettings(),i=this.getActiveConditions(t,{objects:[e]});g.g.setCommonValues(s,i),this[e].setSettings(s)}}getCommonSettings(t){let e=this.getSettings(),s=this[t].getSettings();for(let t of Object.keys(e))/^common\./.test(t)&&(s[t]=e[t]);return s}setCommonSettings(t){let e=[];for(const s of Object.keys(t))/^common\./.test(s)&&e.push(s);if(0!=e.length)for(let s of y){if(!this[s])continue;let i=this[s].getSettings();for(const s of Object.keys(i))e.includes(s)&&(i[s]=t[s]);this[s].setSettings(i)}}getConditions(t){let e=[],s=y;for(let i=0;i<s.length;++i){let r=s[i];this[r]&&(t&&t.objects&&!t.objects.includes(r)||(e=e.concat(this[r].getConditions())))}return e}getActiveConditions(t,e){let s=[],i=y;for(let r=0;r<i.length;++r){let n=i[r];if(!this[n])continue;if(e&&e.objects&&!e.objects.includes(n))continue;let a=this[n].getConditions();for(let e=0;e<a.length;++e){const i=a[e];i.params.hideInactive&&!i.checkSubconditions(t)||s.push(i)}}return s}getArtifactsConditions(){return this.artifacts?this.artifacts.getConditions():[]}getSettings(){let t={},e=y;for(let s=0;s<e.length;++s){let i=e[s];this[i]&&(t=Object.assign(t,this[i].getSettings()))}return t}getBaseStats(t,e){let s=new i.c;t&&s.stats.concat(t),s.settings.concat(this.getSettings(),e);let r=y;for(let t=0;t<r.length;++t){let e=r[t];if(!this[e])continue;let i=this[e].getConditions();for(let t=0;t<i.length;++t){let e=i[t].getData(s.settings);s.stats.concat(e.stats),s.settings.concat(s.settings,e.settings)}}for(let t=0;t<r.length;++t){let e=r[t];if(!this[e])continue;let i=this[e].getStats(s.settings);s.stats.concat(i.stats),s.settings.concat(s.settings,i.settings)}return s.stats.get("dmg_own")&&s.stats.add("dmg_"+s.settings.char_element,s.stats.get("dmg_own")),s.multipliers=this.getMultipliers(),s.postEffects=this.getPostEffects(),s}getBaseStatsWithSets(t,e){let s=this.getBaseStats(t,e),i=this.getPostEffects();return s.stats.applyPostEffects(s.settings,i,p.N.PRE_STATS),s}getPostEffects(){let t=[],e=y;for(let s=0;s<e.length;++s){let i=e[s];this[i]&&(t=t.concat(this[i].getPostEffects()))}return t}getMultipliers(){let t=[];for(let e of y)this[e]&&(t=t.concat(this[e].getMultipliers()));return t=t.concat(DB.CalcData.Multipliers),t}getStats(t,e){return this.getBaseStats(t,e)}getBuildData(t,e){let s=this.getBaseStats(t,e);return s.stats.processPercent(),s}calcFeatures(t){let e=this.getBuildData();return this.getFeatures(e,t)}getFeaturesList(t){let e=[];t=Object.assign({},t);for(let s of y){if(!this[s])continue;let i;if("rotation"==s){if(!t.ignoreRotation){let t=this.compileRotation();t&&(i=[t])}}else i=this[s].getFeatures();i&&(e=e.concat(i))}return e}compileRotation(){return new d.V(this,this.getRotation()).compile()}getFeaturesHash(t,e){e=Object.assign({},e);let s={};for(let i of this.getFeaturesList())t&&!i.checkConditions(t)||e.checkCallback&&!e.checkCallback(i)||(s[i.getName()]=i);return s}getFeatures(t){let e={};for(let s of this.getFeaturesList())e=Object.assign(e,s.getResult(t));return e}getFeaturesNames(){let t={},e=this.getStats(),s=this.getFeaturesList();for(let i=0;i<s.length;++i){const r=s[i];Object.assign(t,r.getFeatureNamesHash(e.stats,e.settings))}return t}getFeatureResultByName(t){let e=this.getFeatureByName(t);if(!e)return;let s=this.getBuildData();return e.getResult(s)[t]}getFeatureByName(t,e){if(!t)return null;e||=this.getBuildData();for(let s of this.getFeaturesList())if(s.isActive(e)&&t==s.getName())return s;return null}getAllFeaturesByName(t,e){if(!t)return[];let s=[];for(let i of this.getFeaturesList(e))t==i.getName()&&s.push(i);return s}clone(){return w.deserialize(this.serialize())}cloneWithArtifactSettings(){let t=w.deserialize(this.serialize());return t.artifacts.modifySettings(this.artifacts.getSettings()),t}getHash(){return m.e.pack(this)}serialize(){let t=[1],e=this.getSettings();for(let t of y)if(this[t])for(let s of this[t].getConditions()){let t=s.getData(e);Object.assign(e,t.settings)}for(let s of b){if(!this[s])return null;let i=this[s].serialize(e);if(!i)return null;t=t.concat(i)}return t}static deserialize(t){let e=null;if(1==t.shift()){if(e=new w,e.char=a.D.deserialize(t),!e.char)return null;if(e.weapon=f.o.deserialize(t),!e.weapon)return null;if(e.artifacts=r.V.deserialize(t),!e.artifacts)return null;if(e.enemy=l.n.deserialize(t),!e.enemy)return null;if(e.buffs=n.T.deserialize(t),!e.buffs)return null;if(e.rotation=u.V.deserialize(t),!e.rotation)return null;if(e.food=o.a.deserialize(t),!e.food)return null}return e}}},74053:(t,e,s)=>{"use strict";s.d(e,{g:()=>n});var i=s(9334),r=s(76760);class n{constructor(t){this.params=t||{},this.entityId=0}getId(){return this.params.serializeId||0}getEntityId(){return this.entityId}getName(){return this.params.name}getNamesList(){return[this.getName()]}getType(){return""}getTitle(t){return this.params.title?UI.Lang.getTalent(this.params.title,t):""}getIcon(){return this.params.icon?this.params.icon.name:""}getDescription(t){return this.params.description?UI.Lang.getTalent(this.params.description,t):""}getInfo(){return this.params.info}getLevel(t){return(0,i.$)(this.params.levelSetting,t)}isHidden(t){if(this.params.isHidden)return!0;let e=this.params.hideCondition;if(e)for(let s=0;s<e.length;++s){if(e[s].isActive(t))return!0}return!1}isActive(t){return this.checkSubconditions(t)}isSerializable(){let t=this.getName(),e=this.getType();return!(!t&&!e||"static"==e)}getMaxStacks(t){return this.params.maxStacks||0}checkSubconditions(t){if(this.params.condition)return this.params.condition.isActive(t);{let e=this.params.subConditions;if(e)for(let s=0;s<e.length;++s){if(!e[s].isActive(t))return!1}}return!0}getData(t){let e={settings:{}};return this.isActive(t)?(e.settings=this.params.settings||{},e.stats=this.getStats(t)):e.stats=new r.j,e}getStats(t){return new r.j(this.params.stats||{})}getBuffRotationSection(t){return this.params.rotation||""}static allConditionsOn(t,e){let s={};for(let i=0;i<t.length;++i){const r=t[i];let n=r.getType();"stacks"==n?s[r.getName()]=r.getMaxStacks():"checkbox"==n?s[r.getName()]=!0:"dropdown"==n?s[r.getName()]=r.params.suggesterValue||0:r.getAllConditionsOn&&Object.assign(s,r.getAllConditionsOn(e))}return s}static allConditionsOff(t){let e={};for(let s=0;s<t.length;++s){const i=t[s];let r=i.getType();"stacks"==r?e[i.getName()]=0:"checkbox"==r&&(e[i.getName()]=!1)}return e}static setCommonValues(t,e){let s={};for(let i=0;i<e.length;++i){const r=e[i].getName();/^common\./.test(r)&&(t[r]||=0,s[r]=t[r])}return s}static unwrap(t,e){let s=[];for(let i of t)if(i.getCondtitionList)for(let t of i.getCondtitionList())e&&!t.isActive(e)||s.push(t);else s.push(i);return s}}},925:(t,e,s)=>{"use strict";s.d(e,{A:()=>c});var i=s(7691),r=s(98143),n=s(22457),a=s(75112),l=s(93962),o=s(49196);class c{constructor(t){this.name=t.name||(t.multipliers&&t.multipliers.length>0?t.multipliers[0].getName():""),this.isChild=t.isChild,this.hits=t.hits,this.icon=t.icon,this.tags=t.tags||[],this.multipliers=t.multipliers||[],this.category=t.category,this.condition=t.condition,this.element="",this.damageType="",this.rotationHitDescription=t.rotationHitDescription||"",this.rotationHitCount=t.rotationHitCount||1,this.critRateBonuses=t.critRateBonuses||[],this.critDamageBonuses=t.critDamageBonuses||[]}getDamageType(){return this.damageType}getElement(){return this.element}getName(){return this.category+"."+this.name}getIsChild(){return this.isChild}getHits(){return this.hits}getTags(){return this.tags}isRotation(){return!1}hasDetails(){return!1}canReact(){}usedInRotation(){return!1}isActive(t){return!this.condition||this.condition.isActive(t.settings)}compile(t){this.compiled=this.getCompiled(t)}getDisplaySettings(t){}getMultipliers(t){let e=[];for(let s of this.multipliers)s.isActive(t)&&e.push(s);for(let s of t.multipliers)s.isActive(t)&&s.isMatchFeature(this,t)&&e.push(s);return e}getActivePostEffectsTree(t){return t.getActivePostEffectsTree()}getCritRateBlock(t){let e=this.getStatsCritRate(t).map((e=>(0,i.oW)(e,t.stats)));return 0==e.length&&(e=[new a.RC({value:0})]),new n.U_(e)}getCritDmgBlock(t){let e=this.getStatsCritDamage(t).map((e=>(0,i.oW)(e,t.stats)));return 0==e.length&&(e=[new a.RC({value:0})]),new n.D$(e)}getCompiled(t,e){if(this.compiled)return this.compiled;e=Object.assign({dontProcessTree:1},e);let s=this.getTree(t),i=this.getActivePostEffectsTree(t),r=new l.x(s,i);return t.settings.reaction&&r.checkForReaction(),t.stats.ensure(r.usedStats),t.stats.ensure(r.assignedStats),r.prepare(t,e),r.compile(e),r}checkConditions(t){return!this.condition||this.condition.isActive(t.settings)}compile(t,e){let s=this.getTree(t);return this.compileTree(s,e)}compileTree(t,e){return e=Object.assign({},e),t.compile(e)}getResult(t){if(!this.checkConditions(t))return{};let e=this.getCompiled(t),[s,i,r]=e.execute(t);return{[this.getName()]:new o.E({icon:this.icon||this.getElement(t),normal:s,crit:i,average:r,isReacted:e.isReacted,format:this.format,digits:this.digits,damageType:this.damageType,noCritValues:this.noCritValues})}}getUsedStats(t){let e=this.getTree(t),s=t.getActivePostEffectsTree(),i=new l.x(e,s);return t.stats.ensure(i.usedStats),i.prepare(t,{}),(0,r.q)(i.processed)}getRotationHitMiltiplier(t){return this.rotationHitCount}getDisplayRotationHitMiltiplier(t){return this.getRotationHitMiltiplier(t)}getRotationHitDescription(){return this.rotationHitDescription}static getTree(t){let e={};for(const s of Object.keys(t)){let i=s.split("."),r=i.shift(),n=i.join(".");void 0===e[r]&&(e[r]={}),e[r][n]=t[s]}return e}static buildDropdown(t,e){e=Object.assign({},e);let s=[],i=t.getFeaturesHash(t.getBuildData(),e),r=c.getTree(i);for(let t of Object.keys(r)){s.push({isCaption:!0,value:"section_"+t,text:UI.Lang.get("feature_section."+t)});for(let e of Object.keys(r[t])){let i=r[t][e];if(i.hidden)continue;let n=t+"."+e,a="feature_"+n;i.title&&(a=i.title),a=UI.Lang.get(a),i.isChild&&(a="â€¢ "+a),s.push({value:n,text:a,isSubitem:!0,isChild:!!i.isChild})}}return s}}},7691:(t,e,s)=>{"use strict";s.d(e,{oW:()=>l,dc:()=>c,yK:()=>u});var i=s(13551),r=s(76760),n=s(35143),a=s(75112);function l(t,e){return t.indexOf("*")>0?function(t,e){if(!i.gE.includes(t))return new n.tR([l(t+"_base",e),l(t,e)],{comment:t,percent:(0,r.h)(t)});return new a.mU({stat:t,value:e.getTotalPercent(t),baseBalue:e.get(t+"_base"),percentValue:e.get(t+"_percent"),flatValue:e.get(t)})}(t.replace("*",""),e):new a.m1({stat:t,value:e.get(t)})}let o=BigInt(0);function c(t){return(t||"var")+"_"+ ++o}function u(t,e){let s=new a.ky({ref:t}),i=new n.pe([new n.S$([new a.RC({value:1}),new n.tR([s,e])])]),r=new n.pe([new n.S$([new a.RC({value:1}),new n.tR([s,new n.YA([new a.RC({value:2}),e])])])]),l=new n.pe([new n.S$([new a.RC({value:1}),new n.tR([s,new n.YA([new a.RC({value:3}),e])])])]),o=new n.pe([new n.S$([new a.RC({value:1}),new n.tR([s,new n.YA([new a.RC({value:4}),e])])])]),c=new n.pe([new n.S$([new a.RC({value:1}),new n.tR([s,new n.YA([new a.RC({value:5}),e])])])]),u=new a.ky({ref:i}),h=new a.ky({ref:r}),f=new a.ky({ref:l}),g=new a.ky({ref:o}),p=new a.ky({ref:c}),d=new n.NK([new n.YA([new a.RC({value:-1}),p]),new n.tR([s,u,h,f,g,new a.RC({value:-1}),new n.YA([new a.RC({value:-1}),s,u]),new n.YA([new a.RC({value:-1}),s,h]),new n.YA([s,u,h]),new n.YA([new a.RC({value:-1}),u,h]),new n.YA([new a.RC({value:-1}),s,f]),new n.YA([s,u,f]),new n.YA([new a.RC({value:-1}),u,f]),new n.YA([s,h,f]),new n.YA([new a.RC({value:-1}),s,u,h,f]),new n.YA([u,h,f]),new n.YA([new a.RC({value:-1}),h,f]),new n.YA([new a.RC({value:-1}),s,g]),new n.YA([s,u,g]),new n.YA([new a.RC({value:-1}),u,g]),new n.YA([s,h,g]),new n.YA([new a.RC({value:-1}),s,u,h,g]),new n.YA([u,h,g]),new n.YA([new a.RC({value:-1}),h,g]),new n.YA([s,f,g]),new n.YA([new a.RC({value:-1}),s,u,f,g]),new n.YA([u,f,g]),new n.YA([new a.RC({value:-1}),s,h,f,g]),new n.YA([s,u,h,f,g]),new n.YA([new a.RC({value:-1}),u,h,f,g]),new n.YA([h,f,g]),new n.YA([new a.RC({value:-1}),f,g]),new n.YA([new a.RC({value:4}),s,p]),new n.YA([new a.RC({value:-3}),s,u,p]),new n.YA([new a.RC({value:3}),u,p]),new n.YA([new a.RC({value:-2}),s,h,p]),new n.YA([new a.RC({value:2}),s,u,h,p]),new n.YA([new a.RC({value:-2}),u,h,p]),new n.YA([new a.RC({value:2}),h,p]),new n.YA([new a.RC({value:-1}),s,f,p]),new n.YA([s,u,f,p]),new n.YA([new a.RC({value:-1}),u,f,p]),new n.YA([s,h,f,p]),new n.YA([new a.RC({value:-1}),s,u,h,f,p]),new n.YA([u,h,f,p]),new n.YA([new a.RC({value:-1}),h,f,p]),new n.YA([f,p]),new n.YA([new a.RC({value:-5}),p])])]);return[[t,i,r,l,o,c],new n.pe([d],{name:"crit_rate_avg"})]}},98143:(t,e,s)=>{"use strict";function i(){let t={};for(let e of arguments)e.walk((e=>{if(e.getUsedStats)for(let s of e.getUsedStats()){let e=r(s);e!=s&&(t[e]=(t[e]||0)+1),t[s]=(t[s]||0)+1}}));return Object.keys(t)}function r(t){return t.replace(/(_\d+)+$/,"")}s.d(e,{q:()=>i,e:()=>r})},24683:(t,e,s)=>{"use strict";s.d(e,{n1:()=>r,_K:()=>n,Jv:()=>a});var i=s(98143);class r{constructor(t,e){this.items=t||[],e&&Object.assign(this,e)}getType(){return"block"}hasItems(){return!0}compileChildrens(t){return this.items.filter((t=>!t.isBlank())).map((e=>e.compile(t)))}isBlank(){for(let t of this.items)if(!t.isBlank())return!1;return!0}isCollapsable(){return!0}isVariableSet(){return!1}isVariableGet(){return!1}process(t){return this}compile(t){return this.compileChildrens(t).join(";\n")}execute(t,e){return t.stats.ensure((0,i.q)(this)),Function("stats","return "+this.compile(e))(t.stats)}getSignature(){return"("+(this.isCollapsable()?"":"!")+this.getType()+":"+this.items.map((t=>t.getSignature())).join(",")+")"}treeBlockFields(){return[this.items]}makeResult(){return this.noReturn?this:new n([this])}walk(t,e){for(let s of this.treeBlockFields()){for(let i of s)e&&e(i)||t(i);for(let i of s)e&&e(i)||i.walk&&i.walk(t,e)}}walkReplace(t){for(let e of this.treeBlockFields()){let s=[];for(let i of e){let e=t(i);e&&s.push(e)}e.splice(0,e.length,...s);for(let s of e)s.walkReplace&&s.walkReplace(t)}}getInfoProperties(){let t={};for(let e of Object.keys(this))"object"!=typeof this[e]&&(t[e]=this[e]);return t}}class n extends r{getType(){return"block_return"}appendChildren(){let t=this.items.pop();for(let t of arguments)this.items.push(t);t&&this.items.push(t)}compile(t){let e=this.items.map((e=>e.compile(t)));return e[e.length-1]="return "+e[e.length-1],e.join(";\n")}}class a{constructor(t){Object.assign(this,t)}getType(){return"item"}hasItems(){return!1}isVariableSet(){return!1}isVariableGet(){return!1}compile(t){return this.value||0}isBlank(){return this.static&&this.blank}process(t){return this}getSignature(){throw`Item ${this.constructor.name} has no "getSignature" method!`}}},35143:(t,e,s)=>{"use strict";s.d(e,{tR:()=>a,w4:()=>l,Cf:()=>o,YA:()=>c,NK:()=>u,S$:()=>h,pe:()=>f,Xh:()=>g,Xg:()=>p,eC:()=>d,V:()=>m,IZ:()=>y});var i=s(7691),r=s(24683),n=s(75112);class a extends r.n1{getType(){return"block_sum"}dontShrink(){return 0}compile(t){let e=this.compileChildrens(t),s=e.join(" + ");return e.length>1&&(s="("+s+")"),s||"0"}process(t){this.items=this.items.map((e=>e.process(t)));let e=this.items.filter((t=>t instanceof n.RC&&0!=t.value)),s=this.items.filter((t=>!(t instanceof n.RC)));if(e.length>1&&!t.dontProcessStaticValues){let t=[],i=0;for(let t of e)i+=t.value;let r=new n.RC({value:i,comment:"processed"});if(0==s.length&&!this.dontShrink())return r;t.push(r);for(let e of s)t.push(e);this.items=t}else this.items=[...e,...s];return 0==this.items.length&&(this.items=[new n.RC({value:0})]),super.process(t)}}class l extends a{getType(){return"block_sum_plus"}compile(t){let e=this.compileChildrens(t);return 0==e.length?"":(e.unshift(1),"("+e.join(" + ")+")")}process(t){return new a([new n.RC({value:1}),...this.items.map((e=>e.process(t)))],this.getInfoProperties(t)).process(t)}}class o extends r.n1{getType(){return"block_subtract"}compile(t){let e=this.compileChildrens(t),s=e.join(" - ");return e.length>1&&(s="("+s+")"),s||"0"}}class c extends r.n1{getType(){return"block_multi"}compile(t){let e=this.compileChildrens(t),s=e.join(" * ");return e.length>1&&(s="("+s+")"),s||0}process(t){this.items=this.items.map((e=>e.process(t)));let e=this.items.filter((t=>t instanceof n.RC&&1!=t.value)),s=this.items.filter((t=>!(t instanceof n.RC)));if(e.length>1&&!t.dontProcessStaticValues){let t=[],i=1;for(let t of e)i*=t.value;let r=new n.RC({value:i,comment:"processed"});if(0==s.length)return r;t.push(r);for(let e of s)t.push(e);this.items=t}else this.items=[...e,...s];return 1==this.items.length&&"block_multi"==this.getType()?this.items[0]:super.process()}}class u extends r.n1{getType(){return"block_divide"}compile(t){let e=this.compileChildrens(t),s=e.join(" / ");return e.length>1&&(s="("+s+")"),s||0}process(t){this.items=this.items.map((e=>e.process(t)));let e=this.items.filter((t=>t instanceof n.RC)),s=this.items.filter((t=>!(t instanceof n.RC)));if(e.length>1&&!t.dontProcessStaticValues){let t=[],i=e.shift().value;for(let t of e)i/=t.value;let r=new n.RC({value:i,comment:"processed"});if(0==s.length)return r;t.push(r);for(let e of s)t.push(e);this.items=t}return super.process()}}class h extends r.n1{getType(){return"block_min"}compile(t){let e=this.compileChildrens(t);return e.length>1?"Math.min("+e.join(", ")+")":e[0]}}class f extends a{getType(){return"variable_set"}isCollapsable(){return!1}isVariableSet(){return!0}constructor(t,e){(e=Object.assign({},e)).name=(0,i.dc)(e.name),super(t,e)}compile(t){return"let "+this.name+" = "+super.compile(t)}}class g extends a{constructor(t,e){e.name=e.ref.name,delete e.ref,super(t,e)}getType(){return"variable_inc"}isCollapsable(){return!1}isVariableSet(){return!0}isVariableGet(){return!0}compile(t){return this.name+" += "+super.compile(t)}}class p extends r.n1{getType(){return"post"}}class d extends r.n1{getType(){return"isolated"}}class m extends a{getType(){return"stat_increase"}isCollapsable(){return!1}getAssignedStats(){return[this.stat]}compile(t){let e=super.compile(t);return this.newName?"stats."+this.newName+" = stats."+this.stat+" + "+e:"stats."+this.stat+" += "+e}}class y extends a{getType(){return"stat_decrease"}isCollapsable(){return!1}getAssignedStats(){return[this.stat]}compile(t){let e=super.compile(t);return"stats."+this.stat+" -= "+e}}},22457:(t,e,s)=>{"use strict";s.d(e,{U_:()=>n,D$:()=>a,$_:()=>o});s(7691);var i=s(24683),r=s(35143);s(75112);class n extends r.tR{compile(t){return`Math.max(0, Math.min(1, ${super.compile(t)}))`}}class a extends r.w4{}class l extends i.n1{getType(){return"damage_result"}isCollapsable(){return!1}compile(t){return"["+this.compileChildrens(t).join(", ")+"]"}getSignature(){return null}}class o extends r.YA{getType(){return"damage_rotation_result"}makeResult(t){return t=Object.assign({},t),new i._K([...this.items,new l(this.vars)])}}},75112:(t,e,s)=>{"use strict";s.d(e,{RC:()=>n,m1:()=>a,mU:()=>l,ky:()=>o});var i=s(24683),r=s(35143);class n extends i.Jv{getType(){return"item_const"}getSignature(){return"(const:"+this.value+")"}}class a extends i.Jv{getType(){return"item_stat"}compile(t){return"stats."+this.stat}process(t){return t.staticStats&&t.staticStats.includes(this.stat)?new n({value:this.value,comment:this.stat}):super.process()}getUsedStats(){return[this.stat]}getSignature(){return"(stat:"+this.stat+")"}}class l extends a{getType(){return"item_stat_total"}getUsedStats(){return[this.stat,this.stat+"_base",this.stat+"_percent"]}process(t){return new r.tR([new r.YA([new a({stat:this.statBaseName(),value:this.baseBalue}),new r.w4([new a({stat:this.statPercentName(),value:this.percentValue})],{comment:this.stat+"_percent",percent:!0})]),new a({stat:this.statFlatName(),value:this.flatValue})],{comment:this.stat}).process(t)}statBaseName(){return this.replaceName(this.stat+"_base")}statPercentName(){return this.replaceName(this.stat+"_percent")}statFlatName(){return this.replaceName(this.stat)}replaceName(t){return this.replace&&this.replace[t]?this.replace[t]:t}compile(t){return`(stats.${this.statBaseName()} * (1 + stats.${this.statPercentName()}) + stats.${this.statFlatName()})`}}class o extends i.Jv{constructor(t){t.name=t.ref.name,delete t.ref,super(t)}getType(){return"variable_get"}isVariableGet(){return!0}compile(t){return this.name}getSignature(){return"(var_value:"+this.name+")"}}},93962:(t,e,s)=>{"use strict";s.d(e,{x:()=>l});s(87189);var i=s(98143),r=s(24683),n=s(35143),a=s(75112);class l{constructor(t,e){this.tree=t,this.postItems=e||[],this.usedStats=(0,i.q)(this.tree,...this.postItems),this.assignedStats=function(){let t={};for(let e of arguments){if(e.getAssignedStats)for(let s of e.getAssignedStats())t[s]=(t[s]||0)+1;e.walk((e=>{if(e.getAssignedStats)for(let s of e.getAssignedStats())t[s]=(t[s]||0)+1}))}return Object.keys(t)}(this.tree,...this.postItems),this.isReacted=!1}checkForReaction(){this.tree.walk((t=>{t.isReacted&&(this.isReacted=!0)}))}prepare(t,e){e=Object.assign({},e);let s,i="damage_rotation_result"==this.tree.getType(),n=this.tree.makeResult();if(i||(s=this.makePostTree(e)),this.processed=new r.n1,e.dontProcessTree||(this.processBlock(n,e),s&&this.processBlock(s,e)),s&&this.processed.items.push(s),this.processed.items.push(n),s&&s.revert&&s.revert.length){let t=this.processed.items[this.processed.items.length-1];t.appendChildren?t.appendChildren(...s.revert):this.processed.items.push(...s.revert)}}processBlock(t,e){t.walkReplace((t=>t.process(e))),t.process(e),this.processVariables(t,e)}makePostTree(t){let e=[];for(let s of this.postItems)(t.dontProcessStats||s.stat&&this.usedStats.includes(s.stat))&&e.push(s);if(0==e.length)return;let[s,i]=l.postTreeBlocks(e,t);return new n.Xg(s,{revert:i})}static filterPostByStats(t,e){let s=[],r=c(t);e=[].concat(e);for(let t of Object.keys(r).sort().reverse())for(let n of r[t]){let t=(0,i.e)(n.stat);if(n.stat&&(e.includes(n.stat)||e.includes(t))){s.push(n);for(let t of(0,i.q)(n))e.includes(t)||e.push(t)}}return s}static postTreeBlocks(t){let e=[],s=[],i=c(t);for(let t of Object.keys(i).sort()){let r=[],l=[];for(let e of i[t]){let t=new n.pe([e],{name:"post_"+e.stat});r.push(t),l.push(new n.V([new a.ky({ref:t})],{stat:e.stat})),s.unshift(new n.IZ([new a.ky({ref:t})],{stat:e.stat}))}e.push(new n.eC([...r,...l]))}return[e,s]}getCode(t){return this.processed.compile(t)}compile(t){let e=this.getCode(t);return this.compiled=Function("stats",e),e}compilePostTree(t){let e=this.makePostTree(t);return e?(t.dontProcessTree||this.processBlock(e,t),Function("stats",e.compile(t))):Function("stats","")}execute(t){return this.compiled(t.stats)}processVariables(t,e){e.dontInsertVariables||t.walk((t=>{"isolated"==t.getType()&&this.replaceBlockRepeat(t)}))}replaceBlockRepeat(t){for(let e=0;e<10;++e){let e={};t.walk((t=>{if(t.hasItems()){let s=t.getSignature();s&&!s.includes("!")&&(e[s]=(e[s]||0)+1)}}),(t=>"isolated"==t.getType()));let s=[];for(let[t,i]of Object.entries(e))i<2||s.push(t);let i=[];for(let t of s){let e=!0;for(let i of s)if(t!=i&&i.indexOf(t)>=0){e=!1;break}e&&i.push(t)}if(0==i.length)break;let r={},l={};t.walkReplace((t=>{let e=t.getSignature();if(e&&i.includes(e)){if(!r[e]){let s=new n.pe([t]);r[e]=s,l[s.name]=s}return new a.ky({ref:r[e]})}return t})),t.items=o(t.items,l)}}}function o(t,e){let s=[];for(;Object.keys(e).length;){s=[];for(let i of t){let t={};i.walk((e=>{e.isVariableGet()&&!e.isVariableSet()&&(t[e.name]=1)}));for(let i of Object.keys(t))e[i]&&(s.push(e[i]),delete e[i]);s.push(i)}t=s}return s}function c(t){let e={};for(let s of t){let t=s.priority;e[t]||(e[t]=[]),e[t].push(s)}return e}},17545:(t,e,s)=>{"use strict";s.d(e,{N:()=>a});var i=s(925),r=s(49196),n=s(4907);class a extends i.A{constructor(t){super(t),this.items=t.items}getName(){return"rotation.total"}getTree(t,e){return new n.U(this.items,e).getTree(t)}compile(t,e){let s=this.getTree(t,e);return this.compileTree(s,e)}compileTree(t,e){return e=Object.assign({},e),t.compile(e)}getResult(t){if(!this.checkConditions(t))return{};let e=this.getCompiled(t),[s,i,n]=e.execute(t),a=this.getElement(t);return t.settings&&t.settings.rotation_include&&(a=t.settings.rotation_include),{[this.getName()]:new r.E({icon:a,normal:s,crit:i,average:n})}}getResultForEditor(t){let e=t.getBuildData();return this.processBlock(this.items,e)}processBlock(t,e){let s=[];for(let i of t)if("feature"==i.type){e.settings.reaction=(0,n.J)(i);let t=l(i.feature,e);if(t){let r=t.getResult(e)[t.getName()];s.push({result:r,count:i.count,subLine:o(i.feature,e)})}else s.push({})}else if("condition"==i.type)i.settings&&e.addSettings(i.settings),i.stats&&e.addStats(i.stats),i.postEffects&&i.postEffects.length&&(e.postEffects=i.postEffects),i.multipliers&&i.multipliers.length&&(e.multipliers=i.multipliers);else if("repeat"==i.type){let t=e.clone();t.addSettings({inside_rotation_block:1});let r=this.processBlock(i.items,t);s=s.concat(r)}else if("uptime"==i.type){let t=e.clone();t.addSettings({inside_rotation_block:1});let r=t.clone(),n=this.processBlock(i.items,t),a=this.processBlock(i.conditions.concat(i.items),r),l=i.percent/100,o=1-l;for(let t=0;t<n.length;++t){let e=n[t].result,s=a[t].result;if(e||s){s?e||(n[t]=Object.assign({},a[t]),e=n[t].result={normal:0,crit:0,average:0}):s={normal:0,crit:0,average:0};for(let t of["normal","crit","average"])e[t]=e[t]*o+s[t]*l}}s=s.concat(n)}else"invalid"==i.type&&s.push({});return s}getDisplaySettings(t){let e={},s={},i=[{settings:{rotation_include:null},setTotal:1,icon:"multi"}];!function t(e,s,i,r){let n=s.clone();for(let s of e)if("feature"==s.type){let t=l(s.feature,n);t&&(i[t.getElement(n)]=1,r[t.getDamageType()]=1)}else"condition"==s.type?(s.settings&&n.addSettings(s.settings),s.stats&&n.addStats(s.stats)):"repeat"==s.type?t(s.items,n,i,r):"uptime"==s.type&&(t(s.items,n,i,r),t([...s.conditions,...s.items],n,i,r))}(this.items,t,e,s);for(let t of Object.keys(e))i.push({id:"rotation.total_"+t,title:"rotation."+t,isChild:!0,settings:{rotation_include:t},getTotal:1});for(let t of Object.keys(s))i.push({id:"rotation.total_"+t,title:"rotation."+t,icon:"multi",isChild:!0,settings:{rotation_include:t},getTotal:1});return i}}function l(t,e){t=Array.isArray(t)?t:[t];for(let s of t)if(s.isActive(e)&&s.usedInRotation())return s}function o(t,e){let s=l(t,e),i=s.getRotationHitDescription(e);if(i)return{descr:"talent_descr."+i,value:s.getDisplayRotationHitMiltiplier(e)}}},4907:(t,e,s)=>{"use strict";s.d(e,{U:()=>u,J:()=>f});var i=s(7691),r=s(98143),n=s(35143),a=s(22457),l=s(75112),o=s(93962);const c=["","melt","vaporize","quicken"];class u{constructor(t,e){t=[].concat(t),this.infoBlock,t.length>0&&"info"==t[0].type&&(this.infoBlock=t.shift()),this.items=t,this.opts=Object.assign({},e)}getTree(t,e){let[s,i,r,n]=this.processBlock(this.items,t,{usedStats:e});return new a.$_(s,{vars:[new l.ky({ref:i}),new l.ky({ref:r}),new l.ky({ref:n})]})}processBlock(t,e,s){let r=new n.pe([new l.RC({value:0})],{name:"total_normal"}),a=new n.pe([new l.RC({value:0})],{name:"total_crit"}),o=new n.pe([new l.RC({value:0})],{name:"total_average"}),c=[r,a,o],u=e.clone(),b=u.settings?u.settings.rotation_include:"",w=[],v=[],C=[];t=function(t){let e=[],s=[];for(let i of t)"feature"==i.type?e.push(i):"condition"==i.type?(s&&(e=e.concat(s),s=[]),e.push(i)):("repeat"==i.type||"uptime"==i.type)&&s.push(i);s&&(e=e.concat(s));return e}(t),this.opts.ignoreSideEffects||(s=p(s));for(let e of t)if("feature"==e.type){u.settings.reaction=f(e);let t=g(e.feature,u);if(!t)continue;if(!t.usedInRotation())continue;if(b){let e=t.getElement(u),s=t.getDamageType();if(b!=e&&b!=s)continue}let c=t.getTree(u);y(c,s);let h=[new l.RC({value:e.count,comment:"rotation_hit_count"}),new n.YA(c.items)],p=t.getRotationHitMiltiplier(u);"object"==typeof p?h.push(p):1!=p&&h.push(new l.RC({value:p,comment:"rotation_hit_multi"}));let d=new n.pe([new n.YA(h)],{name:"normal"}),m=new n.pe([c.critRate],{name:"crit_rate"}),v=new n.pe([c.critDmg],{name:"crit_dmg"}),C=new n.pe([new n.YA([new l.ky({ref:d}),new l.ky({ref:v})])],{name:"crit_hit"}),S=[];c.royalCrit&&([S,m]=(0,i.yK)(m,c.royalCrit)),S.length>0&&(w=w.concat(S)),w.push(d),w.push(m),w.push(v),w.push(C),w.push(new n.Xh([new l.ky({ref:d})],{ref:r})),w.push(new n.Xh([new l.ky({ref:C})],{ref:a})),w.push(new n.Xh([new n.YA([new l.ky({ref:d}),new n.Cf([new l.RC({value:1}),new l.ky({ref:m})])]),new n.YA([new l.ky({ref:C}),new l.ky({ref:m})])],{ref:o}))}else if("condition"==e.type){if(w.length||v.length||C.length){let t=h(w,v,C,s);t&&c.push(t),w=[],v=[],C=[]}for(let t of Object.keys(e.stats)){if(/^text_/.test(t))continue;let i={stat:t};if(s.copyStats){let e=d(s,t),r=m(t);i={stat:e,newName:r},s.stats[t]=r}v.push(new n.V([new l.RC({value:e.stats.get(t)})],i))}s.usedStats&&e.stats.truncate(s.usedStats),u.addStats(e.stats),u.addSettings(e.settings);let t=s&&s.stats?Object.keys(s.stats):[];for(let i of e.postEffects)if(i.getTree)for(let e of i.getTree(u,s))t.includes(e.stat)&&(e.stat=s.stats[e.stat]),y(e,s),C.push(e)}else if("repeat"==e.type){if(w.length||v.length||C.length){let t=h(w,v,C,s);t&&c.push(t),w=[],v=[],C=[]}let[t,i,f,g]=this.processBlock(e.items,u,p(s));w.push(h([...t,...[[i,r],[f,a],[g,o]].map((t=>{let[s,i]=t;return new n.Xh([new n.YA([new l.RC({value:e.count}),new l.ky({ref:s})])],{ref:i})}))],[],[],s))}else if("uptime"==e.type){if(w.length||v.length||C.length){let t=h(w,v,C,s);t&&c.push(t),w=[],v=[],C=[]}if(e.percent>0){let t=e.percent/100,[i,c,f,g]=this.processBlock([...e.conditions,...e.items],u,p(s));w.push(h([...i,...[[c,r],[f,a],[g,o]].map((e=>{let[s,i]=e;return new n.Xh([new n.YA([new l.RC({value:t}),new l.ky({ref:s})])],{ref:i})}))],[],[],s))}if(e.percent<100){let t=1-e.percent/100,[i,c,f,g]=this.processBlock(e.items,u,p(s));w.push(h([...i,...[[c,r],[f,a],[g,o]].map((e=>{let[s,i]=e;return new n.Xh([new n.YA([new l.RC({value:t}),new l.ky({ref:s})])],{ref:i})}))],[],[],s))}}if(w.length||v.length||C.length){let t=h(w,v,C,s);t&&c.push(t)}return[c,r,a,o]}}function h(t,e,s,i){if(0==t.length&&0==e.length)return null;let a=(0,r.q)(...t),l=t,c=o.x.filterPostByStats(s,a);if(c.length){let[t,e]=o.x.postTreeBlocks(c);l=[...t,new n.eC(l),...e]}return e.length&&(l=[...e,...l]),new n.eC(l)}function f(t){return c[t.reaction||0]}function g(t,e){t=Array.isArray(t)?t:[t];for(let s of t)if(s.isActive(e)&&s.usedInRotation())return s}function p(t){let e=Object.assign({},t);if(e.stats={},e.copyStats=!0,t.stats)for(let s of Object.keys(t.stats))e.stats[s]=t.stats[s];return e}function d(t,e){return t.stats&&t.stats[e]||e}function m(t){return(0,i.dc)(t)}function y(t,e){if(e.stats){let s=Object.keys(e.stats);t.walk((t=>{if("item_stat_total"==t.getType())for(let i of[t.stat,t.stat+"_base",t.stat+"_percent"])s.includes(i)&&(t.replace||(t.replace={}),t.replace[i]=e.stats[i]);else t.stat&&s.includes(t.stat)&&(t.stat=e.stats[t.stat])}))}}},49196:(t,e,s)=>{"use strict";s.d(e,{E:()=>i});class i{constructor(t){if(this.critChance=0,this.critMulti=1,t){let e=Object.keys(t);for(let s=0;s<e.length;++s){const i=e[s];this[i]=t[i]}}this.calcCritValues()}isHealing(){return this.icon&&"heal"==this.icon}calcCritValues(){void 0===this.average&&(this.normal?(this.crit=this.normal*this.critMulti,this.average=this.normal*(1-this.critChance)+this.crit*this.critChance):(this.normal=0,this.crit=0,this.average=0))}clone(){let t=Object.assign({},this);return Object.setPrototypeOf(t,i.prototype),t}}},66196:(t,e,s)=>{"use strict";s.d(e,{N:()=>i});const i={DEFAULT:2,PRE_STATS:1,SET_BONUS:1,STAT_LOCAL:2,STAT_GLOBAL:3,STAT_DMG_BONUS:4}},43164:(t,e,s)=>{"use strict";s.d(e,{ok:()=>a,mi:()=>l});var i=s(74053),r=s(58121),n=s(76760);const a={1:"reaction.melt",2:"reaction.vaporize"};class l{constructor(t){this.name=t&&t.name||"",this.items=t&&t.items||[]}addItem(t){this.items.push(t)}getItems(){return this.items}getfeaturesNames(){let t=u(this.items);return Object.keys(t)}getItem(t){return h(t,this.items)}replaceItem(t,e){let s=this.getItem(t);if(s){for(let t of Object.getOwnPropertyNames(s))"id"!=t&&delete s[t];for(let t of Object.getOwnPropertyNames(e))s[t]=e[t]}}deleteItem(t){let e=this.getItem(t);e&&f(e,this.items)}clone(){return l.deserialize(this.serialize())}getHash(){return r.e.pack(this)}serialize(){let t=o(this.getItems());return t.unshift(0),t.unshift(3),t}static deserialize(t){let e=t.shift(),s=null;if(1==e||2==e||3==e){e>=2&&t.shift();let i=c(t,0,e);s=new l({items:i})}return s}static getConditionData(t,e){let s={cond:null,typeId:0,icon:"",object:"",dbObject:null,invalid:!0},r=[],n=[];if("char"==t.subtype){let i=DB.Chars.getById(t.itemId);i&&(s.typeId=1,s.object="char",s.dbObject=i,s.icon="sprite-char "+i.getIcon(),r=i.getAllConditions(),e&&t.itemId==e.getChar().getId()&&(n=r))}else if("weapon"==t.subtype){let i=DB.Conditions.Weapon;r=r.concat(i);let a=DB.Weapons.getById(t.itemId);a&&(s.typeId=2,s.object="weapon",s.icon="sprite-weapon-"+a.weapon+" "+a.getIcon(),r=r.concat(a.getConditions()),e&&t.itemId==e.getWeapon().getId()&&(n=r))}else if("artifacts"==t.subtype){let i=DB.Artifacts.Sets.getById(t.itemId);i&&(s.typeId=3,s.object="artifacts",s.icon="sprite-artifact "+i.getImage()+" flower",r=i.getConditions(5),e&&(n=e.getConditions({objects:[t.subtype]})))}else if("enemy"==t.subtype){if(r=r.concat(DB.Conditions.Enemy),s.typeId=4,s.object="enemy",t.itemId){let e=DB.Enemies.getById(t.itemId);e&&(s.icon="sprite-enemy "+e.getImage(),r=r.concat(e.getConditions()),n=r)}}else if("party"==t.subtype){let a=DB.Chars.getById(t.itemId);if(a&&(s.typeId=5,s.object="buffs",s.icon="sprite-char "+a.getIcon(),r=i.g.unwrap(a.getPartyConditions()),e)){let s=e.getSettings();for(let e=1;e<=3;++e)s["party_char_"+e]==t.itemId&&(n=r)}}else if("buffs"==t.subtype){let e,a=[];for(const t of DB.Buffs.getList())a=a.concat(t.getConditions());for(let s of i.g.unwrap(a))if(s.getId()==t.conditionId){e=s;break}e&&(s.typeId=6,s.object="buffs",s.icon=e.getIcon(),r=[e],n=r)}for(const e of r)if(e.getId()==t.conditionId){s.cond=e;break}for(const e of n)if(e.getId()==t.conditionId){s.invalid=!1;break}return s}static getArtSetByCondition(t){for(const e of DB.Artifacts.Sets.getList())for(const s of e.getConditions(5))if(s.getId()==t)return e.getId();return 0}static getEnemyByCondition(t){for(const e of DB.Enemies.getList())for(const s of e.getConditions())if(s.getId()==t)return e.getId();return 0}}function o(t){let e=[],s=0;for(const i of t)if(i)if(e.push(i.disabled?1:0),e.push(i.collapsed?1:0),"feature"==i.type){let t=DB.Features.Rotation.getByName(i.feature);t&&(++s,e.push(1),e.push(t),e.push(Math.max(1,i.count)),e.push(i.reaction||0))}else if("condition"==i.type){let t=l.getConditionData(i);if(t.cond){let r;++s,e.push(2),e.push(t.typeId),e.push(i.itemId),e.push(t.cond.params.serializeId),r="decimal"==t.cond.params.format?Math.floor(10*parseFloat(i.value)):+i.value,e.push(r||0)}}else if("repeat"==i.type){++s,e.push(3),e.push(Math.max(1,i.count));let t=o(i.items);e=e.concat(t)}else if("uptime"==i.type){++s,e.push(4),e.push(1),e.push(Math.min(100,Math.max(0,i.percent)));let t=o([].concat(i.conditions,i.features));e=e.concat(t)}return e.unshift(s),e}function c(t,e,s){let i=t.shift(),r=[];for(let a=0;a<i;++a){let i={disabled:!1};s>=2&&(i.disabled=!!t.shift()),s>=3&&(i.collapsed=!!t.shift());let a=t.shift();if(i.id=++e,1==a){i.type="feature";let e=t.shift();if(i.feature=DB.Features.Rotation.getById(e),!i.feature)return null;i.count=Math.max(1,t.shift()),i.reaction=t.shift()}else if(2==a){i.type="condition";let e=t.shift();if(1==e)i.subtype="char";else if(2==e)i.subtype="weapon";else if(3==e)i.subtype="artifacts";else if(4==e)i.subtype="enemy";else if(5==e)i.subtype="party";else{if(6!=e)return null;i.subtype="buffs"}i.itemId=t.shift(),i.conditionId=t.shift();let s=l.getConditionData(i),r=t.shift();s&&s.cond&&"decimal"==s.cond.params.format&&(r=n.j.format("text_decimal",r/10,{no_decimal_zero:!0})),i.value=r}else if(3==a)i.type="repeat",i.count=Math.max(1,t.shift()),i.items=c(t,e,s),e+=i.items.length;else{if(4!=a)return null;{i.type="uptime",i.typeId=t.shift(),i.percent=Math.min(100,Math.max(0,t.shift())),i.conditions=[],i.features=[];let r=c(t,e,s);e+=r.length;for(let t of r)"condition"==t.type?i.conditions.push(t):i.features.push(t)}}r.push(i)}return r}function u(t){let e={};for(const s of t){"feature"==s.type&&(e[s.feature]=1);for(let t of["items","conditions","features"])if(s.hasOwnProperty(t)){let i=u(s[t]);e=Object.assign(e,i)}}return e}function h(t,e){for(let s of e){if(s.id==t)return s;for(let e of["items","conditions","features"])if(s.hasOwnProperty(e)){let i=h(t,s[e]);if(i)return i}}return null}function f(t,e){let s=e.indexOf(t);if(s>=0)return e.splice(s,1),1;for(let s of e)for(let e of["items","conditions","features"])if(s.hasOwnProperty(e)){if(f(t,s[e]))return 1}return 0}},42651:(t,e,s)=>{"use strict";s.d(e,{V:()=>l});var i=s(61828),r=s(17545),n=s(43164),a=s(76760);class l{constructor(t,e,s){this.build=t,this.rotation=e,this.opts=Object.assign({},s)}buildFeaturesList(){let t={},e=this.rotation.getfeaturesNames();for(let t of Object.keys(n.ok))e.push(n.ok[t]);for(let s of e){let e=this.build.getAllFeaturesByName(s,{ignoreRotation:!0});e.length&&(t[s]=e)}if(this.opts.loadArtifactsFeatures){let e=this.build.getBuildData();for(let s of DB.Artifacts.Sets.getList())for(let i of s.getFeatures(5)){let s=i.getResult(e.stats,e.settings);for(let e of Object.keys(s))t[e]=i}}return t}processConditions(t){if(0==this.conditions.length)return;let e=t.getBuildData(),s={},r=0;for(const a of this.conditions){let l,o={};if(a.static)o=a.getSettings(e.settings),l=a.object,++r;else{let e=n.mi.getConditionData(a,t);if(!e.invalid&&e.cond&&e.cond.getName()&&i.s.includes(e.object)){++r,l=e.object;let t=e.cond.getType();o[e.cond.getName()]="dropdown"==t||"dropdown_multiple"==t?e.cond.getValueById(a.value):a.value}}l&&(s=Object.assign(s,o),t[l].addSettings(o),t.setCommonSettings(o))}if(this.conditions=[],!r)return;let l=t.getBuildData(),o=l.getActivePostEffects(),c=a.j.diff(e.stats,l.stats),u=function(t,e){let s={};for(let i of Object.keys(e))void 0!==t[i]&&t[i]==e[i]||(s[i]=e[i]);for(let i of Object.keys(t))void 0===e[i]&&(s[i]=void 0);return s}(e.settings,l.settings);return Object.keys(c).length||Object.keys(u).length||o.length?{type:"condition",stats:c,settings:u,postEffects:o}:void 0}processBlock(t,e,s){let i=[],r=[],n=e.filter((t=>!t.disabled));n.length&&"condition"!=n[0].type&&r.push({type:"condition",static:1,getSettings:()=>({})});for(const t of e)if(r.push(t),"feature"==t.type&&this.features[t.feature])for(let e of this.features[t.feature])if(e&&e.getRotationAfterItems){let i=e.getRotationAfterItems(t,{insideBlock:s});for(const t of i)r.push(t)}for(const e of r)if(!e.disabled){if("condition"!=e.type){let e=this.processConditions(t);e&&i.push(e)}if("feature"==e.type){let t=this.features[e.feature];if(t){++this.featuresTotal;let s={type:e.type,feature:t,featureName:e.feature,count:e.count,reaction:e.reaction};i.push(s)}else i.push({type:"invalid"})}else if("condition"==e.type)this.conditions.push(e);else if("repeat"==e.type){let s=this.processBlock(t,e.items,1);s&&i.push({type:e.type,count:e.count,items:s})}else if("uptime"==e.type){let s=this.processBlock(t,e.features,1);if(!s)continue;let r=this.processBlock(t,e.conditions,1);0==r.length?i.push({type:"repeat",count:1,items:s}):i.push({type:e.type,percent:e.percent,conditions:r,items:s})}}let a=this.processConditions(t);return a&&i.push(a),i}buildInfoBlock(){let t={type:"info"},e=0;if(this.sideEffectStats.length&&(e=1,t.sideEffectStats=this.sideEffectStats),e)return t}compile(){this.features=this.buildFeaturesList(),this.featuresTotal=0,this.conditions=[],this.sideEffectStats=[];let t=[].concat(this.rotation.getItems());t.unshift({type:"condition",static:1,getSettings:()=>({})});let e=this.processBlock(this.build.cloneWithArtifactSettings(),t);if(0==this.featuresTotal)return null;let s=this.buildInfoBlock();return s&&e.unshift(s),new r.N({name:this.rotation.name,items:e})}}},58121:(t,e,s)=>{"use strict";s.d(e,{e:()=>i});class i{static pack(t){let e=t.serialize(),s="";if(e){for(const t of e)s+=r(t);return s}}static unpack(t){let e=t.split(""),s=[],i=0;for(;e.length>0;){let t=e.shift();"\0"==t&&(t="b");let r=t.toUpperCase().charCodeAt(0)-65;if(r<0&&r>25)return null;i+=r,t.toLowerCase()==t?(s.push(i),i=0):i*=26}return i&&s.push(i),s}}function r(t){let e=parseInt(t),s="";for(;e>25;){let t=e%26;e-=t,e/=26,s=String.fromCharCode(65+t)+s}s=String.fromCharCode(65+e)+s;let i=s.substring(s.length-1);return s.substring(0,s.length-1).toUpperCase()+i.toLowerCase()}},25627:(t,e,s)=>{"use strict";s.d(e,{I:()=>i});class i{constructor(t,e){this.stat=t,this.values=e}getName(){return this.stat}getValue(t){return t>0?(t>this.values.length&&(t=this.values.length),this.values[t-1]):0}getValues(){return this.values}multiply(t){let e=[];for(let s of this.values)e.push(s*t);return new i(this.stat,e)}}},76760:(t,e,s)=>{"use strict";s.d(e,{j:()=>i,h:()=>r});class i{constructor(t){if(t)for(let e of Object.keys(t))this[e]=t[e]}add(t,e){this[t]=(this[t]||0)+e}set(t,e){this[t]=e}get(t){return this[t]||0}del(t){delete this[t]}isSet(t){return this.hasOwnProperty(t)}getTotal(t){let e=this.get(t+"_base"),s=this.get(t),i=this.get(t+"_percent");return i&&e&&(s+=e*(i/100)),e+s}getTotalPercent(t){return this.get(t+"_base")*(1+this.get(t+"_percent"))+this.get(t)}getBaseBonus(t){let e=this.get("base_dmg_bonus_"+t),s=this.get(t+"_base_atk_percent");return s&&(e+=this.getTotal("atk")*s/100),s=this.get(t+"_base_def_percent"),s&&(e+=this.getTotal("def")*s/100),s=this.get(t+"_base_hp_percent"),s&&(e+=this.getTotal("hp")*s/100),s=this.get(t+"_base_mastery_percent"),s&&(e+=this.getTotal("mastery")*s/100),e}isEmpty(){return 0==Object.keys(this).length}concat(t){for(let e of Object.keys(t))this[e]=(this[e]||0)+t[e]}getSetFunc(){let t=[];for(let e of Object.keys(this))t.push(`stats.${e} = ${this[e]}`);return Function("stats",t.join(";"))}getConcatFunc(t){let e=[];for(let t of Object.keys(this))e.push(`stats.${t} += ${this[t]}`);if(t)for(let s of Object.keys(t))e.push(`stats.${s} = ${t[s]}`);return Function("stats",e.join(";"))}truncate(t){for(let e of Object.keys(this))t.includes(e)||delete this[e]}ensure(t){for(let e of t)this[e]||=0}processPercent(){for(let t of Object.keys(this))r(t)&&(this[t]=this[t]/100)}revertPercent(){for(let t of Object.keys(this))r(t)&&(this[t]=100*this[t])}calcPost(){let t=this.calcTotals();if(this.post_atk_hp_bonus){let e=this.get("post_atk_hp_bonus")/100;this.add("atk",t.get("hp_total")*e)}}calcTotals(t){let e=new i;t||="";for(const s of["atk","def","hp"]){if(t&&t!=s)continue;let i=this.get(s+"_base"),r=i*this.get(s+"_percent")/100+this.get(s),n=i+r;e.add(s+"_base",i),e.add(s+"_bonus",r),e.add(s+"_total",n)}for(const s of["crit_rate","crit_dmg","mastery","healing","healing_recv","recharge","shield","recovery"]){if(t&&t!=s)continue;let i=this.get(s+"_base"),r=this.get(s),n=i+r;e.add(s+"_base",i),e.add(s+"_bonus",r),e.add(s+"_total",n)}for(const s of["anemo","geo","electro","pyro","cryo","hydro","phys"])for(const i of["dmg_","res_"]){if(t&&t!=i+s)continue;let r=this.get(i+s+"_base"),n=this.get(i+s),a=r+n;e.add(i+s+"_base",r),e.add(i+s+"_bonus",n),e.add(i+s+"_total",a)}return e}applyPostEffects(t,e,s){if(e&&e.length){let r={};for(const t of e){let e=t.getPriority();s&&e>s||(r[e]||(r[e]=[]),r[e].push(t))}for(let e of Object.keys(r).sort(((t,e)=>t-e))){let s=new i;for(const i of r[e]){let e=i.getData(this,t);s.concat(e)}this.concat(s)}}}getFormatted(t,e){return i.format(t,this.get(t),e)}revert(){let t=new i,e=Object.keys(this);for(let s=0;s<e.length;++s){const i=e[s];t.add(i,-1*this[i])}return t}static roundStatValue(t,e,s){let i=s||r(t||"");return e=parseFloat(e)+1e-8,i?e.toFixed(1):Math.round(e)}static format(t,e,s){s||={};let i=e,n=r(t);return Math.abs(e)<1e-5?s.zero?"0":"":(!function(t){if(r(t))return!0;if(t.match(/(_cooldown|_decimal)/))return!0;return!1}(t)?(i=Math.round(i),s.minimize&&(i>1e7?i=(i/1e6).toFixed(2)+"m":i>1e6&&(i=(i/1e6).toFixed(3)+"m"))):(i+=1e-8,i=i.toFixed(s.decimal_digits||1),s.no_decimal_zero&&(i=i.replace(/(\.\d*?)0+$/,"$1"),i=i.replace(/\.$/,"")),n&&(i+="%")),i=i.toString().replace(/\B(?=(\d{3})+(?!\d))/g," "),s.signed&&(e<0?"0"==i&&(i="-0"):i="+"+i),i)}static diff(t,e){let s=Object.assign({},t,e),r=new i;for(const i of Object.keys(s)){let s=e.get(i)-t.get(i);s&&r.add(i,s)}return r}}function r(t){return!!t.match(/_percent/)||!!t.match(/^(bond_of_life|stamina|recovery|duration|atk_speed|move_speed|healing|recharge|crit_|dmg_|enemy_|res_|.*bonus_|.*shield|.*_multi)/)}},19478:(t,e,s)=>{"use strict";s.d(e,{O:()=>r});var i=s(76760);function r(t,e,s){let r=DB.Artifacts.Substats.get(t),a=DB.Artifacts.Rarity[e-1],l=r.rolls[e-1],o="percent"==r.type,c=n([],s,l,a.maxUpgrades,o);c=function(t){let e={};for(let s of t){let t=s.pop();e[[].concat(s.sort(),[t]).join("-")]=1}let s=[];for(const t of Object.keys(e).sort())s.push(t.split("-"));return s}(c),c=c.sort((function(t,e){return t[t.length-1]-e[e.length-1]||t.length-e.length}));let u=c[0],h=[];u||(u=[0]);let f=i.j.roundStatValue("",u.pop(),o);for(let t of u){let e=1;for(let s=0;s<l.length;++s)t==l[s]&&(e=2+s);h.push({value:i.j.roundStatValue("",t,o),rarity:e})}return{steps:h,maxValue:h.length*l[l.length-1],last:f,maxUpgrades:a.maxUpgrades}}function n(t,e,s,i,r){let l=[];if(i<=0){let s=a(t,e,r),i=[].concat(t);return i.push(Math.abs(s)),[i]}for(let o of s){let c=[].concat(t);c.push(o);let u=a(c,e,r);u>0?l=l.concat(n(c,e,s,i-1,r)):(0==u?c.push(0):(c=[].concat(t),c.push(Math.abs(o+u))),l.push(c))}return l}function a(t,e,s){let r=t.reduce((function(t,e){return t+e}),0),n=i.j.roundStatValue("",e,s)-i.j.roundStatValue("",r,s);return Math.abs(n)<.001?0:e-r}},13551:(t,e,s)=>{"use strict";s.d(e,{gE:()=>i});const i=["atk","hp","def"]}}]);