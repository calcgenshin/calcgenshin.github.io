(()=>{"use strict";var t,e,s={87189:(t,e,s)=>{s.d(e,{c:()=>l,U:()=>c});var i=s(98143),a=s(24683),r=s(93962),n=(s(66196),s(76760)),o=s(9334);class l{constructor(t,e){this.stats=new n.j(e),this.settings=new o.q(t),this.multipliers=[],this.postEffects=[]}addStats(t){this.stats.concat(t)}addSettings(t){this.settings.concat(t)}getActivePostEffects(){return this.postEffects.filter((t=>t.isActive(this.settings)))}getActivePostEffectsTree(){let t=this.getActivePostEffects(),e=[];for(let s of t)if(s.getTree)for(let t of s.getTree(this))e.push(t);return e}applyPostEffects(t){for(let t of this.postEffectTreeByPriority()){let e=new r.x(new a.n1([]),t),s=e.compilePostTree({dontProcessStats:!0});s&&(this.stats.ensure(e.usedStats),this.stats.ensure(e.assignedStats),s(this.stats))}this.postEffects=[]}postEffectByPriority(t){t=Object.assign({},t);let e=this.getActivePostEffects(),s={};for(let i of e){let e=i.getPriority();t.maxPriority&&e>t.maxPriority||(s[e]||(s[e]=[]),s[e].push(i))}let i=[];for(let t of Object.keys(s).sort())i.push(s[t]);return i}postEffectTreeByPriority(t){let e=this.postEffectByPriority(t),s=[];for(let t of e){let e=[];for(let s of t)e=e.concat(s.getTree(this));s.push(e)}return s}getResistance(t){return this.settings.get("enemy_res_"+t)+100*this.stats.get("enemy_res_"+t)}clone(){let t=new l(this.settings,this.stats);return t.postEffects=[].concat(this.postEffects),t.multipliers=[].concat(this.multipliers),t}}function c(t,e){let s=[].concat(e),a=[];for(let e of t){let t=[];for(let r of e)s.includes(r.stat)&&(a.push(r),t=t.concat((0,i.q)(r)));s=s.concat(t)}return a}},16440:(t,e,s)=>{var i=s(73935),a=s(13551),r=s(87189),n=s(74053),o=s(24683),l=s(93962),c=s(76760);const f={normal:0,crit:1,average:2},u=["crit_value"];class h{constructor(t){this.build=t.build,this.artifacts=t.artifacts,this.featureName=t.featureName,this.featureType=t.featureType,this.settings=t.settings,this.limit=t.limit||20}prepare(){this.currentArts=this.build.getArtifacts(),this.build.clearArtifacts(),this.build.artifacts.modifySettings(this.settings.sets_settings),this.buildData=this.build.getBuildData();let t=this.build.getActiveConditions(this.buildData.settings);n.g.setCommonValues(this.buildData.settings,t),this.prepareArtifactSets(),this.prepareDynamicStats();let e={ignoreSideEffects:1,staticStats:[]};this.featureVariants={},this.usedStats=[];let s=[],r=[];for(let t of Object.keys(this.settings.stats||{}))t=t.replace("_min","").replace("_max",""),r.push(t),r.push(t+"_base"),a.gE.includes(t)&&r.push(t+"_percent");this.usedStats=this.usedStats.concat(r);for(let t of this.getVariations()){let e=this.build.clone(),a=Object.assign({},this.settings.sets_settings),r=[],n=[];for(let e of t)if(e.setId){r.push(e.name),a[i.v.settingName(e.setId)]=e.pieces;for(let t=0;t<e.pieces;++t)n.push(e.setId)}for(let t of DB.Artifacts.Slots.getKeys()){let s=n.pop();if(!s)break;let a=new i.v(5,20,t,s,"",[]);e.setArtifact(a)}let o=r.sort().join("-")||"default";e.artifacts.modifySettings(a);let l=e.getBuildData();this.addDynamicStats(l.getActivePostEffectsTree());let c=e.getFeatureByName(this.featureName);c.items&&this.addDynamicStatsFromItems(l,c.items),s.push({variandId:o,feature:c,buildData:l})}for(let t of s){let s=t.buildData.postEffectTreeByPriority(),i=this.filterPostEffects(t.feature,t.buildData),a=t.feature.getTree(t.buildData,e),n=new l.x(a,i),o=n.usedStats;this.usedStats=this.usedStats.concat(o),o=o.concat(r),t.buildData.stats.ensure(o),e.staticStats=this.makeStaticStats(o),n.prepare(t.buildData,e),n.compile(e),n.checkFunc=d(this.settings.stats,s),this.featureVariants[t.variandId]=n}this.buildData.stats.truncate(this.usedStats),this.buildData.stats.ensure(this.usedStats),this.prepareArtifacts()}getVariations(){let t={},e=[];for(let s of Object.keys(this.setData))for(let i of Object.keys(this.setData[s])){let a=this.setData[s][i];a.variation&&!t[a.variation]&&(t[a.variation]=1,e.push({name:a.variation,setId:s,pieces:parseInt(i)}))}let s=[[{name:"default"}]];for(let t=0;t<e.length;++t){let i=e[t];s.push([i]);for(let a=t+1;a<e.length;++a){let t=e[a];i.pieces+t.pieces<=5&&s.push([i,t])}}return s}filterPostEffects(t,e){if(t.isRotation())return[];let s=e.postEffectTreeByPriority();e.postEffects=[];let i=[];for(let a of s){let s=t.getTree(e),r=new l.x(s,i).usedStats;for(let t of a)for(let e of t.getAssignedStats())r.includes(e)&&i.push(t)}return i}prepareArtifacts(){this.slots={flower:[],plume:[],sands:[],goblet:[],circlet:[]},this.setNames={},this.totalCombinations=1;for(let t of this.artifacts)this.setNames[t.set]=1,t.calcCache(this.usedStats),t.concatFunc=t.calculated.getConcatFunc(),this.slots[t.slot].push(t);for(const t of Object.keys(this.slots)){if(0==this.slots[t].length){let e=this.currentArts[t];if(e)e.calcCache(this.usedStats),this.slots[t].push(e);else{let e=new i.v(5,0,t,"none","none",[]);e.isEmpty=!0,e.calculated=new c.j,e.concatFunc=e.calculated.getConcatFunc(),this.slots[t].push(e)}}this.totalCombinations*=this.slots[t].length}}prepareArtifactSets(){let t={};for(let e of this.artifacts)t[e.set]||(t[e.set]={}),t[e.set][e.slot]=1;let e={};for(let s of Object.keys(t))e[s]=Object.keys(t[s]).length;this.setData={};let s=Object.assign({},this.buildData.settings),a=this.buildData.getActivePostEffects().length;for(let t of DB.Artifacts.Sets.getKeys()){let r,o=DB.Artifacts.Sets.get(t).getConditionsByPieces(),l=new c.j,f={},u=i.v.settingNameShort(t),h=e[t]||0,p=this.build.getBuildData(),d=a,g="";for(let e=1;e<o.length&&!(e>h);++e){p.addSettings({[i.v.settingName(t)]:e});const a=o[e];let h={};if(a.length){h=n.g.allConditionsOn(a,s);for(let t of Object.keys(h))s.hasOwnProperty(t)&&(h[t]=s[t]);let t=Object.assign({},h,s),e=new c.j;for(let s of a){let i=s.getData(t);e.concat(i.stats)}l.concat(e),Object.assign(f,h),p.addSettings(h)}let m=p.getActivePostEffects().length,b=a.filter((t=>t.isSerializable())).length;if(m>d?(d=m,g=u+e):b&&(g=u+e),Object.keys(l).length||r||g){let s=new c.j(l);s.processPercent(),this.setData[t]||(this.setData[t]={}),this.setData[t][e]={stats:s,variation:g,concatFunc:s.getConcatFunc()}}}}}prepareDynamicStats(){let t={};for(let e of DB.Artifacts.Mainstats.getKeys())t[e]=1;for(let e of DB.Artifacts.Substats.getKeys())t[e]=1;for(let e of Object.keys(this.setData))for(let s of Object.keys(this.setData[e])){let i=this.setData[e][s].stats;for(let e of Object.keys(i))/^text_/.test(e)||(t[e]=1)}this.dynamicStats=Object.keys(t)}addDynamicStats(t){for(let e of t)e.stat&&!this.dynamicStats.includes(e.stat)&&this.dynamicStats.push(e.stat)}addDynamicStatsFromItems(t,e){for(let s of e){if(s.postEffects)for(let e of s.postEffects)e.getTree&&this.addDynamicStats(e.getTree(t));s.items&&this.addDynamicStatsFromItems(t,s.items),s.conditions&&this.addDynamicStatsFromItems(t,s.conditions)}}makeStaticStats(t){let e=[];for(let s of t)this.dynamicStats.includes(s)||u.includes(s)||e.push(s);return e}getResult(t){let e,s,i,a,r,n,o=[],l=0;this.currentCombinations=0,this.skippedCombinations=0;let u=f[this.featureType],h=this.buildData.stats.getSetFunc(),d=function*(t,e,s,i){let a,r,n,o,l,c={};for(let t of Object.keys(e))c[t]=0;let f=function(t){let e=[];for(let[s,i]of Object.entries(t.setMaxValues))e.push("if (sets."+s+" >= "+i+") {return true}");return e.push("return false"),Function("sets",e.join(";"))}(t),u=function(t){let e=[];for(let[s,i]of Object.entries(t.setMinValues))e.push("if (sets."+s+" < "+i+") {return true}");return e.push("return false"),Function("sets",e.join(";"))}(t),h=s.circlet.length,p=h*s.goblet.length,d=p*s.sands.length;for(let t=0;t<s.flower.length;--c[a.set],++t){a=s.flower[t],++c[a.set];for(let t=0;t<s.plume.length;--c[r.set],++t)if(r=s.plume[t],++c[r.set],f(c))i(d);else for(let t=0;t<s.sands.length;--c[n.set],++t)if(n=s.sands[t],++c[n.set],f(c))i(p);else for(let t=0;t<s.goblet.length;--c[o.set],++t)if(o=s.goblet[t],++c[o.set],f(c))i(h);else for(let t=0;t<s.circlet.length;--c[l.set],++t)l=s.circlet[t],++c[l.set],f(c)||u(c)?i(1):yield[a,r,n,o,l]}}(this.settings,this.setNames,this.slots,(e=>{this.currentCombinations+=e,this.skippedCombinations+=e,(t&&this.currentCombinations%5e4==0||e>5e4)&&t(this.currentCombinations,this.totalCombinations,this.skippedCombinations)}));for(t(this.currentCombinations,this.totalCombinations,this.skippedCombinations);(e=d.next())&&!e.done;){++this.currentCombinations,i={},s=e.value,a=new c.j,h(a);for(let t of s)t&&(i[t.set]=(i[t.set]||0)+1,t.concatFunc(a));let f=[];for(let t in i){let e=this.setData[t]&&this.setData[t][i[t]];e&&(e.variation&&f.push(e.variation),e.concatFunc&&e.concatFunc(a))}f=f.sort().join("-")||"default";let d=this.featureVariants[f];!d.checkFunc||d.checkFunc(a)?(this.buildData.stats=a,r=d.execute(this.buildData),n=r[u]||0,n>=l&&o.push({value:n,artifacts:s})):++this.skippedCombinations,t&&this.currentCombinations%5e4==0&&(o.length>100*this.limit&&(p(o,this.limit),l=o[o.length-1].value),t(this.currentCombinations,this.totalCombinations,this.skippedCombinations))}return t(this.currentCombinations,this.totalCombinations,this.skippedCombinations),p(o,this.limit),function(t){for(let e of t){let t=[];for(let s of e.artifacts)s.isEmpty||t.push(s);e.artifacts=t}}(o),o}}function p(t,e){(t=t.sort((function(t,e){return e.value-t.value}))).splice(e)}function d(t,e){let[s,i]=function(t){let e=[],s=[];for(let i of Object.keys(t)){let r,[n,o,l]=/^(.*)_(min|max)$/.exec(i),f=t[i];f&&((0,c.h)(o)&&(f/=100),r=a.gE.includes(o)?"stats."+o+"_base * (1 + stats."+o+"_percent) + stats."+o:"stats."+o+"_base + stats."+o,s.includes(o)||(s.push(o),s.push(o+"_base"),a.gE.includes(o)&&s.push(o+"_percent")),"max"==l?e.push("if ("+r+" > "+f+") {return false}"):"min"==l&&e.push("if ("+r+" < "+f+") {return false}"))}return[e,s]}(t);if(0==s.length)return;let n=s.join(";\n"),o=(0,r.U)(e,i);if(o){let[t,e]=l.x.postTreeBlocks(o);n=g(t)+";\n"+n+";\n"+g(e)}return Function("stats",n+";\nreturn true")}function g(t){let e=new l.x(new o.n1(t,{noReturn:!0}),[]);return e.prepare(),e.getCode()}var m=s(61828);importScripts("db.js?3.1.3b"),self.onmessage=function(t){let e=[];for(let s of t.data.artifacts)e.push(i.v.deserialize(s));let s=new h({build:m.G.deserialize(t.data.calcset),artifacts:e,featureName:t.data.feature,featureType:t.data.featureType,settings:t.data.settings,limit:t.data.limit});s.prepare();let a=s.getResult(((t,e,s)=>{self.postMessage({count:t,total:e,skipped:s})}));if(a.length>0){for(let t of a){let e=[];for(let s of t.artifacts)e.push(s?s.serialize():null);t.artifacts=e}self.postMessage({result:a})}else self.postMessage({result:[]})}}},i={};function a(t){var e=i[t];if(void 0!==e)return e.exports;var r=i[t]={exports:{}};return s[t](r,r.exports,a),r.exports}a.m=s,a.x=()=>{var t=a.O(void 0,[651],(()=>a(16440)));return t=a.O(t)},t=[],a.O=(e,s,i,r)=>{if(!s){var n=1/0;for(c=0;c<t.length;c++){for(var[s,i,r]=t[c],o=!0,l=0;l<s.length;l++)(!1&r||n>=r)&&Object.keys(a.O).every((t=>a.O[t](s[l])))?s.splice(l--,1):(o=!1,r<n&&(n=r));o&&(t.splice(c--,1),e=i())}return e}r=r||0;for(var c=t.length;c>0&&t[c-1][2]>r;c--)t[c]=t[c-1];t[c]=[s,i,r]},a.d=(t,e)=>{for(var s in e)a.o(e,s)&&!a.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},a.f={},a.e=t=>Promise.all(Object.keys(a.f).reduce(((e,s)=>(a.f[s](t,e),e)),[])),a.u=t=>"js/"+t+"_edc88974b4af9385efeb.js",a.miniCssF=t=>{},a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t;a.g.importScripts&&(t=a.g.location+"");var e=a.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var s=e.getElementsByTagName("script");s.length&&(t=s[s.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=t+"../"})(),(()=>{var t={440:1};a.f.i=(e,s)=>{t[e]||importScripts(a.p+a.u(e))};var e=self.webpackChunkgenshin_impact_calculator=self.webpackChunkgenshin_impact_calculator||[],s=e.push.bind(e);e.push=e=>{var[i,r,n]=e;for(var o in r)a.o(r,o)&&(a.m[o]=r[o]);for(n&&n(a);i.length;)t[i.pop()]=1;s(e)}})(),e=a.x,a.x=()=>a.e(651).then(e);a.x()})();