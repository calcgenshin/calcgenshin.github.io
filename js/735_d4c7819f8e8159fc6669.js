(()=>{"use strict";var t,s,e={87189:(t,s,e)=>{e.d(s,{c:()=>a});var i=e(24683),l=e(93962),r=(e(66196),e(76760)),o=e(9334);class a{constructor(t,s){this.stats=new r.j(s),this.settings=new o.q(t),this.multipliers=[],this.postEffects=[]}addStats(t){this.stats.concat(t)}addSettings(t){this.settings.concat(t)}getActivePostEffects(){return this.postEffects.filter((t=>t.isActive(this.settings)))}getActivePostEffectsTree(){let t=this.getActivePostEffects(),s=[];for(let e of t)if(e.getTree)for(let t of e.getTree(this))s.push(t);return s}applyPostEffects(t){for(let t of this.postEffectTreeByPriority()){let s=new l.x(new i.n1([]),t),e=s.compilePostTree({dontProcessStats:!0});e&&(this.stats.ensure(s.usedStats),this.stats.ensure(s.assignedStats),e(this.stats))}this.postEffects=[]}postEffectByPriority(t){t=Object.assign({},t);let s=this.getActivePostEffects(),e={};for(let i of s){let s=i.getPriority();t.maxPriority&&s>t.maxPriority||(e[s]||(e[s]=[]),e[s].push(i))}let i=[];for(let t of Object.keys(e).sort())i.push(e[t]);return i}postEffectTreeByPriority(t){let s=this.postEffectByPriority(t),e=[];for(let t of s){let s=[];for(let e of t)s=s.concat(e.getTree(this));e.push(s)}return e}getResistance(t){return this.settings.get("enemy_res_"+t)+100*this.stats.get("enemy_res_"+t)}clone(){let t=new a(this.settings,this.stats);return t.postEffects=[].concat(this.postEffects),t.multipliers=[].concat(this.multipliers),t}}},78354:(t,s,e)=>{var i=e(61828),l=e(73935),r=e(74053),o=e(93962),a=e(76760);class h{constructor(t){this.build=t.build,this.combinations=t.combinations,this.featureName=t.feature,this.settings=t.settings,this.progressCallback=t.progressCallback,this.prepare()}prepare(){this.applySets();let t=this.build.getFeatureByName(this.featureName);this.buildData=this.build.getBuildData();let s=this.buildData.getActivePostEffectsTree(),e=t.getTree(this.buildData),i=new o.x(e,s),l=i.usedStats,r=["recharge"].concat(l);this.buildData.stats.ensure(r),l.includes("crit_value")&&(this.calcCritValue=!0,l.push("crit_rate"),l.push("crit_dmg")),i.prepare(this.buildData),i.compile(),this.compiled=i,this.usefulStats=[],this.uselessStats=[],this.statRolls=function(t){let s={};for(let e of DB.Artifacts.Substats.getKeys()){let i=DB.Artifacts.Substats.get(e).rolls[4];if(s[e]="min"==t?[i[0]]:"max"==t?[i[i.length-1]]:[i[1],i[2]],(0,a.h)(e))for(let t=0;t<s[e].length;++t)s[e][t]=s[e][t]/100}return s}(this.settings.mode);for(let t of DB.Artifacts.Substats.getKeys())l.includes(t)?this.usefulStats.push(t):this.uselessStats.push(t);this.progressTotal=this.combinations.length*this.usefulStats.length,this.progressCurrent=0}setsList(){let t=Array.isArray(this.settings.sets)?[].concat(this.settings.sets):[];if(t.length<5){let s=[];for(let t of DB.Artifacts.Sets.getList())t.isBeta()||s.push(t.key);for(let e of f(s)){if(t.includes(e))continue;if(!(DB.Artifacts.Sets.get(e).maxRarity<5)&&(t.push(e),t.length>=5))break}}return f(t)}applySets(){let t=this.setsList();this.artifactSets=[].concat(t),this.build.clearArtifacts();let s=["hp","atk"];for(let e of DB.Artifacts.Slots.getKeys()){let i=new l.v(5,20,e,t.shift()||"",s.shift()||"",[]);this.build.setArtifact(i)}let e=this.build.getConditions({objects:"artifacts"}),i=r.g.allConditionsOn(e);this.settings.required_sets_settings&&(i=Object.assign(i,this.settings.required_sets_settings)),this.build.setArtifactsSettings(i)}makeTestObject(t,s){let e=new n(t,this.usefulStats,this.usefulStats,this.statRolls,this.settings);if(e.satisfyStat("recharge",this.minRecharge,s))return e}makeObject(t,s){return new n(t,this.usefulStats,this.uselessStats,this.statRolls,this.settings)}generate(){let t=[],s=this.buildData.stats.getSetFunc();this.minRecharge=this.settings.minRecharge/100;for(let e of this.combinations){let i,l=c(e),r=0;for(let t of this.usefulStats){let o=new a.j,h=this.usefulStats.length-1;s(o),l(o);let n=this.makeTestObject(e,o);if(!n){this.updateProgress();continue}let u=n.getStatRollsAllowed(t);for(let o=1;o<=u;++o){let n=new a.j;s(n),l(n);let u,c=this.makeObject(e,n);c.satisfyStat("recharge",this.minRecharge,n);for(let s=0;s<o;s++){let s=c.addRoll(t);n.add(t,s)}if(h>0)for(;;){let s,e=c.getAllowedRolls(t);if(0==e.length)break;if([s,u]=this.getBestRoll(n,e),!s)break;let i=c.addRoll(s);n.add(s,i)}else this.buildData.stats=n,u=this.compiled.execute(this.buildData)[2];u>r&&(r=u,i=c)}this.updateProgress()}i&&t.push({value:r,mainStats:e,rollsPerStat:i.getDistribution(),artifacts:i.makeArtifacts(this.setsList())})}return t.sort(((t,s)=>s.value-t.value))}getBestRoll(t,s){let e,i=0;for(let l of s){t.add(l.stat,l.value),this.calcCritValue&&t.set("crit_value",2*t.get("crit_rate")+t.get("crit_dmg")),this.buildData.stats=t;let s=this.compiled.execute(this.buildData)[2];s>i&&(i=s,e=l.stat),t.add(l.stat,-1*l.value)}return[e,i]}updateProgress(){++this.progressCurrent,this.progressCallback&&this.progressCallback({total:this.progressTotal,completed:this.progressCurrent})}}class n{constructor(t,s,e,i,l){this.mainStats={flower:"hp",plume:"atk",...t},this.usefulStats=s,this.uselessStats=e,this.rollsCnt=0,this.rolls={},this.statValues=i,this.stats=new a.j,this.settings=l}getMainStatsCnt(t){let s=0;for(let e of Object.values(this.mainStats))t==e&&++s;return s}getStatMaxAllowed(t){let s=this.settings.count,e=45,i=6*(5-this.getMainStatsCnt(t));return"crit_rate"!=t&&"crit_dmg"!=t||(e=this.settings.critRolls),Math.min(s,e,i)}getStatRollsAllowed(t){let s=0;return"crit_rate"==t||"crit_dmg"==t?(s+=this.rolls.crit_rate?this.rolls.crit_rate.length:0,s+=this.rolls.crit_dmg?this.rolls.crit_dmg.length:0):s=this.rolls[t]?this.rolls[t].length:0,this.getStatMaxAllowed(t)-s}getAllowedRolls(t){let s=[];if(this.rollsCnt>=this.settings.count)return s;let e=0;for(let t of Object.keys(this.rolls)){let s=this.rolls[t].length;for(let e of Object.values(this.mainStats))t!=e&&--s;e+=Math.max(0,s)}for(let i of DB.Artifacts.Substats.getKeys()){if(t&&t==i)continue;if(!this.usefulStats.includes(i))continue;if(e>=25&&this.rolls[i])continue;let l=this.getRollValue(i);this.getStatRollsAllowed(i)>0&&s.push({stat:i,value:l})}return s}getRollValue(t){let s=this.statValues[t].length;if(s>1){let e=(1+(this.rolls[t]?this.rolls[t].length:0))%s;return this.statValues[t][e]}return this.statValues[t][0]}satisfyStat(t,s,e){let i=e.getTotal(t);for(;i-s<-.001;){if(this.getStatRollsAllowed(t)<=0)return!1;let s=this.addRoll(t);i+=s,e.add(t,s)}return!0}addRoll(t){let s=this.getRollValue(t);return this.rolls[t]||(this.rolls[t]=[]),this.rolls[t].push(s),++this.rollsCnt,this.stats.add(t,s),s}getDistribution(){let t={};for(let[s,e]of Object.entries(this.rolls))t[s]=e.length;return t}getDistibutor(){return new u(this.mainStats,this.rolls)}makeArtifacts(t){let s=[],e=this.getDistibutor();e.process(),e.fillUselessStats(this.uselessStats,this.statValues);for(let i of Object.keys(this.mainStats)){let r=new l.v(5,20,i,t.shift(),this.mainStats[i],[]);for(let[t,s]of Object.entries(e.result[i])){let e=s.reduce(((t,s)=>t+s));(0,a.h)(t)?(e=Math.round(1e4*e)/100,e=Math.round(10*e)/10,e=parseFloat(e.toFixed(1))):e=Math.round(e),r.addStat(t,e)}s.push(r)}return s}}class u{constructor(t,s){this.mainStats=t,this.rolls={};for(let t of Object.keys(s))this.rolls[t]=[].concat(s[t]);this.prepare(),this.result={plume:{},flower:{},sands:{},goblet:{},circlet:{}},this.rollsCount={plume:0,flower:0,sands:0,goblet:0,circlet:0},this.upgradesCount={plume:0,flower:0,sands:0,goblet:0,circlet:0}}prepare(){this.possibleStatSlots={};for(let t of Object.keys(this.rolls)){this.possibleStatSlots[t]=[];for(let s of Object.keys(this.mainStats))this.mainStats[s]!=t&&this.possibleStatSlots[t].push(s)}}process(){this.lowCounters();let t={};for(let s of Object.keys(this.rolls)){let e=Object.values(this.mainStats).reduce(((t,e)=>t+(s==e?0:1)),0);t[e]||(t[e]=[]),t[e].push(s)}for(let s of Object.keys(t).sort(((t,s)=>t-s))){let e=t[s];for(;0!=e.length;)for(let t of e){let s=this.rolls[t].splice(0,1);this.putIntoLowestCount(t,s),0==this.rolls[t].length&&(delete this.rolls[t],e.splice(e.indexOf(t),1))}}this.balanceUpgrades()}balanceUpgrades(){if(Object.values(this.upgradesCount).reduce(((t,s)=>t+s),0)<=25)return;let t=1,s=0;for(;t&&!(++s>10);){t=0;t:for(let s of Object.keys(this.mainStats))if(!(this.upgradesCount[s]<=5))for(let e of Object.keys(this.result[s]))if(1!=this.result[s][e].length)for(let i of Object.keys(this.mainStats)){if(s==i)continue;if(e==this.mainStats[i])continue;if(this.result[i][e])continue;if(Object.keys(this.result[i]).length>=4)continue;let l=this.result[s][e].pop();this.result[i][e]=[l],--this.upgradesCount[s],t=1;break t}}for(s=0,t=1;t&&!(++s>10);){t=0;t:for(let s of Object.keys(this.mainStats))if(!(this.upgradesCount[s]<=5))for(let e of Object.keys(this.result[s]))if(1!=this.result[s][e].length)for(let i of Object.keys(this.mainStats)){if(s==i)continue;if(e==this.mainStats[i])continue;if(!this.result[i][e])continue;if(this.upgradesCount[i]>=5)continue;let l=this.result[s][e].pop();this.result[i][e].push(l),--this.upgradesCount[s],++this.upgradesCount[i],t=1;break t}}}fillUselessStats(t,s){for(let[e,i]of Object.entries(this.mainStats)){let l=f([].concat(t)).filter((t=>t!=i)),r=[];for(;Object.keys(this.result[e]).length<4;){let t=l.pop();if(!t)break;r.push(t),this.putIntoSlot(e,t,s[t][0])}if(0!=r.length)for(;this.upgradesCount[e]<5;)for(let t of r)if(this.putIntoSlot(e,t,s[t][0]),this.upgradesCount[e]>=5)break}}lowCounters(){for(let t of Object.keys(this.rolls))this.rolls[t].length>2||(this.putIntoLowestDifferent(t,this.rolls[t]),delete this.rolls[t])}putIntoLowestCount(t,s){let e=[];for(let[s,i]of Object.entries(this.mainStats))t!=i&&(Object.keys(this.result[s]).length>=4&&!this.result[s][t]||this.result[s][t]&&this.upgradesCount[s]>=5||e.push({slot:s,used:this.upgradesCount[s]+Object.values(this.result[s]).length-(this.result[s][t]?0:2)}));if(0==e.length)for(let[s,i]of Object.entries(this.mainStats))t!=i&&this.result[s][t]&&e.push({slot:s,used:this.upgradesCount[s]});e=e.sort(((t,s)=>t.used-s.used)),this.putIntoSlot(e[0].slot,t,s)}putIntoLowestDifferent(t,s){let e=[];for(let[s,i]of Object.entries(this.mainStats))t!=i&&(Object.keys(this.result[s])>=4&&!this.result[s][t]||e.push({slot:s,used:Object.values(this.result[s]).length}));e=e.sort(((t,s)=>t.used-s.used)),this.putIntoSlot(e[0].slot,t,s)}putIntoSlot(t,s,e){this.result[t][s]||(Object.keys(this.result[t]).length,this.result[t][s]=[]),this.result[t][s]=this.result[t][s].concat(e),this.rollsCount[t]+=e.length,this.refreshUpgrages(t)}refreshUpgrages(t){let s=0;for(let[e,i]of Object.entries(this.result[t]))s+=i.length-1;this.upgradesCount[t]=s}}function c(t){let s=new a.j;for(let e of Object.keys(t)){let i=t[e],l=DB.Artifacts.Mainstats.get(i).values[4].getValue(20);(0,a.h)(i)&&(l/=100),s.add(i,l)}return s.getConcatFunc()}function f(t){let s,e=[].concat(t),i=e.length;for(;0!=i;)s=Math.floor(Math.random()*i),i--,[e[i],e[s]]=[e[s],e[i]];return e}class g extends h{makeTestObject(t,s){let e=new p(t,this.usefulStats,this.usefulStats,this.statRolls,this.settings);for(let t of DB.Artifacts.Substats.getKeys())for(let i=1;i<=2;++i){let i=e.addRoll(t);s.add(t,i)}if(e.satisfyStat("recharge",this.minRecharge,s))return e}makeObject(t,s){let e=new p(t,this.usefulStats,this.uselessStats,this.statRolls,this.settings);for(let t of DB.Artifacts.Substats.getKeys())for(let i=1;i<=2;++i){let i=e.addRoll(t);s.add(t,i)}return e}}class p extends n{constructor(t,s,e,i,l){(l=Object.assign({},l)).count=40,l.critRolls=40,super(t,s,e,i,l)}getStatMaxAllowed(t){let s=2+2*(5-this.getMainStatsCnt(t));return Math.min(40,s)}getStatRollsAllowed(t){let s=this.rolls[t]?this.rolls[t].length:0;return this.getStatMaxAllowed(t)-s}getDistibutor(){return new d(this.mainStats,this.rolls)}}class d extends u{fillUselessStats(){}process(){for(let t of Object.keys(this.rolls)){let s=this.rolls[t].splice(0,1);this.putIntoLowestCount(t,s),0==this.rolls[t].length&&delete this.rolls[t]}let t={};for(let s of Object.keys(this.rolls)){let e=Object.values(this.mainStats).reduce(((t,e)=>t+(s==e?0:1)),0);t[e]||(t[e]=[]),t[e].push(s)}let s={};for(let t of Object.keys(this.rolls))s[t]=this.rolls[t].length;for(let t of Object.keys(s).sort(((t,e)=>s[e]-s[t])))for(;this.rolls[t]&&this.rolls[t].length>0;){let s=this.rolls[t].splice(0,1);this.putIntoLowestCount(t,s),0==this.rolls[t].length&&delete this.rolls[t]}}}importScripts("db.js?3.1.3b"),self.onmessage=function(t){let s;t.data.build=i.G.deserialize(t.data.build),t.data.progressCallback=t=>{self.postMessage({progress:t})},s=t.data.settings.kqms?new g(t.data):new h(t.data);let e=s.generate();for(let t of e){let s=[];for(let e of t.artifacts)s.push(e.serialize());t.artifacts=s}self.postMessage({result:e})}}},i={};function l(t){var s=i[t];if(void 0!==s)return s.exports;var r=i[t]={exports:{}};return e[t](r,r.exports,l),r.exports}l.m=e,l.x=()=>{var t=l.O(void 0,[651],(()=>l(78354)));return t=l.O(t)},t=[],l.O=(s,e,i,r)=>{if(!e){var o=1/0;for(n=0;n<t.length;n++){for(var[e,i,r]=t[n],a=!0,h=0;h<e.length;h++)(!1&r||o>=r)&&Object.keys(l.O).every((t=>l.O[t](e[h])))?e.splice(h--,1):(a=!1,r<o&&(o=r));a&&(t.splice(n--,1),s=i())}return s}r=r||0;for(var n=t.length;n>0&&t[n-1][2]>r;n--)t[n]=t[n-1];t[n]=[e,i,r]},l.d=(t,s)=>{for(var e in s)l.o(s,e)&&!l.o(t,e)&&Object.defineProperty(t,e,{enumerable:!0,get:s[e]})},l.f={},l.e=t=>Promise.all(Object.keys(l.f).reduce(((s,e)=>(l.f[e](t,s),s)),[])),l.u=t=>"js/"+t+"_edc88974b4af9385efeb.js",l.miniCssF=t=>{},l.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),l.o=(t,s)=>Object.prototype.hasOwnProperty.call(t,s),(()=>{var t;l.g.importScripts&&(t=l.g.location+"");var s=l.g.document;if(!t&&s&&(s.currentScript&&(t=s.currentScript.src),!t)){var e=s.getElementsByTagName("script");e.length&&(t=e[e.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),l.p=t+"../"})(),(()=>{var t={735:1};l.f.i=(s,e)=>{t[s]||importScripts(l.p+l.u(s))};var s=self.webpackChunkgenshin_impact_calculator=self.webpackChunkgenshin_impact_calculator||[],e=s.push.bind(s);s.push=s=>{var[i,r,o]=s;for(var a in r)l.o(r,a)&&(l.m[a]=r[a]);for(o&&o(l);i.length;)t[i.pop()]=1;e(s)}})(),s=l.x,l.x=()=>l.e(651).then(s);l.x()})();